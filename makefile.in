CC = @CC@
DEFS = @DEFS@
CFLAGS = @CFLAGS@
LDFLAGS = @LDFLAGS@
LIBS = @LIBINTL@ @LIBS@

GUILE_LIBS = @GUILE_LIBS@
XM_LIBS = @XM_LIBS@
GUILE_CFLAGS = @GUILE_CFLAGS@
GTK_CFLAGS = @GTK_CFLAGS@
GTK_LIBS = @GTK_LIBS@
MOTIF_LIBS = @XLIBS@
MOTIF_FLAGS = @XFLAGS@
AUDIO_LIB = @AUDIO_LIB@
XMHTML_LIB = @XMHTML_LIB@
GTKHTML_LIB = @GTKHTML_LIB@
GTKHTML_FLAGS = @GTKHTML_FLAGS@
GSL_LIBS = @GSL_LIBS@
GSL_FLAGS = @GSL_CFLAGS@
GL_LIBS = @GL_LIBS@
GL_FILES = @GL_FILES@
GL_FLAGS = @GL_FLAGS@
FFTW_LIBS = @FFTW_LIBS@
SNDLIB_FILES = $(@SNDLIB_FILES@)
SNDLIB_LIB = @SNDLIB_LIB@

GX_HEADERS = $(@GX_HEADERS@)
GX_FILES = $(@GX_FILES@)

LDSO_FLAGS = @LDSO_FLAGS@
SO_INSTALL = @SO_INSTALL@
SO_LD = @SO_LD@
A_LD = @A_LD@
A_LD_FLAGS = @A_LD_FLAGS@

SHELL = /bin/sh
top_srcdir = .
DESTDIR =
PACKAGE = @PACKAGE@
VERSION = @VERSION@
datadir = @datadir@
localedir = $(datadir)/locale
DEFS = -DLOCALEDIR=\"$(localedir)\" @DEFS@
SUBDIRS = po

.c.o:
	$(CC) -c $(DEFS) $(GTK_CFLAGS) $(CFLAGS) $(GUILE_CFLAGS) $(MOTIF_FLAGS) $(GSL_FLAGS) $(GTKHTML_FLAGS) $(GL_FLAGS) $<

INSTALL = @INSTALL@
mkinstalldirs = $(SHELL) $(top_srcdir)/mkinstalldirs
prefix = @prefix@
exec_prefix = @exec_prefix@
bindir = @bindir@
srcdir = @srcdir@
mandir = @mandir@

include $(srcdir)/makesnd.files

main_target: @MAKE_TARGET@

snd: $(SNDLIB_HEADERS) $(SND_HEADERS) $(GX_HEADERS) $(SNDLIB_FILES) $(O_FILES) $(GX_FILES) $(GL_FILES)
	(cd po && $(MAKE))
	$(CC) $(LDFLAGS) $(CFLAGS) $(SNDLIB_FILES) $(O_FILES) $(GX_FILES) $(GL_FILES) -o snd $(SNDLIB_LIB) $(GUILE_LIBS) $(GTK_LIBS) $(GL_LIBS) $(MOTIF_LIBS) $(AUDIO_LIB) $(FFTW_LIBS) $(GSL_LIBS) $(XMHTML_LIB) $(GTKHTML_LIB) $(LIBS)

xm: 	xen.h xen.o
	$(CC) -c xm.c -DUNDEF_USE_SND $(DEFS) $(GTK_CFLAGS) $(CFLAGS) $(GUILE_CFLAGS) $(MOTIF_FLAGS) $(GSL_FLAGS) $(GTKHTML_FLAGS) $(GL_FLAGS)
	$(SO_LD) xen.o $(GM_FILES) -o $(GM_SO_FILE) $(LDSO_FLAGS) $(XM_LIBS) $(GL_LIBS) $(MOTIF_LIBS) $(LIBS)

xg: 	xen.h xen.o
	$(CC) -c xg.c -DUNDEF_USE_SND $(DEFS) $(GTK_CFLAGS) $(CFLAGS) $(GUILE_CFLAGS) $(MOTIF_FLAGS) $(GSL_FLAGS) $(GTKHTML_FLAGS) $(GL_FLAGS)
	$(SO_LD) xen.o $(GG_FILES) -o $(GG_SO_FILE) $(LDSO_FLAGS) $(GTK_LIBS) $(LIBS)

widget: snd_widget.o

snd_widget.o: $(SNDLIB_HEADERS) $(SND_HEADERS) $(GX_HEADERS) $(SNDLIB_FILES) $(O_FILES) $(GX_FILES) $(GL_FILES)
	$(LD) -r $(LDFLAGS) $(SNDLIB_FILES) $(O_FILES) $(GX_FILES) $(GL_FILES) -o snd_widget.o

include $(srcdir)/makesnd.back

Makefile: Makefile.in config.status
	./config.status

config.status: configure
	./config.status --recheck

configure: configure.in
	cd $(srcdir); autoconf


# the order GUILE_LIBS then GTK_LIBS (and possibly others) can cause trouble because
#   GUILE_LIBS may start with -L/usr/local/lib, whereas GTK_LIBS leaves off the
#   directory, but assumes /usr/lib.  An older version sitting on /usr/local/lib
#   will therefore get accidentally loaded.  I fear the only fix is to delete the
#   libraries on /usr/local/lib.

