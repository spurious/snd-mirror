<html>
<head>
<title>Snd Customization and Extension</title>
<style type="text/css">
<!-- 
	EM.red {color:red; font-style:normal}
        EM.typing {color:maroon; font-style: normal}
        EM.listener {color:darkblue; font-style: normal}
        EM.tab {font-style: normal; font-size: small; font-family: fixed}
	EM.emdef {font-weight: bold; font-style: normal; padding-right: 0.2cm}
	H1 {text-align: center}
	UL {list-style-type: none}

	A {text-decoration:none}
	A:hover {text-decoration:underline}
	A.quiet {color:black; text-decoration:none}
	A.quiet:hover {text-decoration:underline}
	A.def {font-weight: bold; font-style: normal; text-decoration:none; text-color:black; padding-right: 0.2cm}
-->
</style>
</head>
<body bgcolor=white>

<script language=JavaScript type="text/javascript" src="wz_tooltip.js"></script>
<script language=JavaScript type="text/javascript" src="wz_data.js"></script>


<!-- I'm using A NAME (i.e caps) where the entity should be ignored by the indexer (make-index.scm) -->

<A NAME="grfsndcontents"></a>
<table border=0 bordercolor="lightgreen" width=100% cellpadding=2 cellspacing=0><tr><td bgcolor="lightgreen">
<table width="100%" border=0><tr><td bgcolor="beige" align="center" valign="middle"><h1>Snd Customization and Extension Part 2</h1></td></tr></table>
</td></tr></table>
<br>

<center>
<table bgcolor="aliceblue" border=0 cellspacing=8><tr>
<td><small>related documentation:</small></td>
<td><small><a href="snd.html" onmouseout="UnTip()" onmouseover="Tip(snd_html_tip)">snd.html</a></small></td>
<td><small><a href="extsnd.html" onmouseout="UnTip()" onmouseover="Tip(extsnd_html_tip)">extsnd.html</a></small></td>
<td><small><a href="sndscm.html" onmouseout="UnTip()" onmouseover="Tip(sndscm_html_tip)">sndscm.html</a></small></td>
<td><small><a href="sndclm.html" onmouseout="UnTip()" onmouseover="Tip(sndclm_html_tip)">sndclm.html</a></small></td>
<td><small><a href="fm.html" onmouseout="UnTip()" onmouseover="Tip(fm_html_tip)">fm.html</a></small></td>
<td><small><a href="sndlib.html" onmouseout="UnTip()" onmouseover="Tip(sndlib_html_tip)">sndlib.html</a></small></td>
<td><small><a href="libxm.html" onmouseout="UnTip()" onmouseover="Tip(libxm_html_tip)">libxm.html</a></small></td>
<td><small><a href="s7.html" onmouseout="UnTip()" onmouseover="Tip(s7_html_tip)">s7.html</a></small></td>
<td><small><a href="index.html" onmouseout="UnTip()" onmouseover="Tip(index_html_tip)">index.html</a></small></td>
</tr></table>
</center>


<table border=0 cellpadding=5 vspace=10 hspace=20>
<tr><th>this file:</th><th>extsnd.html:</th></tr>
<tr><td width="40%">
<ul>
<li><a href="#startup">Snd Startup</a>
  <ul>
  <li><a href="#sndswitches" onmouseout="UnTip()" onmouseover="Tip('startup switches such as -l and -p')">Snd invocation flags</a>
  <li><a href="#sndinitfile" onmouseout="UnTip()" onmouseover="Tip('~/.snd, ~/.snd_s7, ~/.snd_prefs_s7, etc')">The initialization file</a>
  <li><a href="#sndconfigurationswitches" onmouseout="UnTip()" onmouseover="Tip('this refers to the configure script that prepares a makefile to build Snd from its sources')">Configuration choices</a>
  <li><a href="#sndenvvars" onmouseout="UnTip()" onmouseover="Tip('mostly related to audio hardware choices')">Environment variables</a>
  </ul>
<li><a href="#snddynamic">Runtime modules and external programs</a>
  <ul>
  <li><a href="#emacssnd" onmouseout="UnTip()" onmouseover="Tip('Use Emacs as the listener')">Snd as an Emacs subjob</a>
  <li><a href="#dynamic" onmouseout="UnTip()" onmouseover="Tip('Load your own C code into Snd')">Dynamically loaded modules</a>
  <li><a href="#sndaswidget" onmouseout="UnTip()" onmouseover="Tip('Embed Snd in some other program')">Snd as a Widget</a>
  <li><a href="#sndwithclm" onmouseout="UnTip()" onmouseover="Tip('CLM is built into Snd')">Snd and CLM</a>
  <li><a href="#sndwithcm" onmouseout="UnTip()" onmouseover="Tip('CM is Rick Taube\'s composition environment')">Snd and Common Music</a>
  <li><a href="#sndwithmotif" onmouseout="UnTip()" onmouseover="Tip('Motif extensions from xm.c')">Snd and Motif</a>
  <li><a href="#sndwithgtk" onmouseout="UnTip()" onmouseover="Tip('Gtk extensions from xg.c')">Snd and Gtk</a>
  <li><a href="#sndwithnogui">Snd with no GUI and as scripting engine</a>
  <li><a href="#sndandruby" onmouseout="UnTip()" onmouseover="Tip('Ruby is a scripting/extension language somewhat like Python')">Snd with Ruby</a>
  <li><a href="#sndandforth" onmouseout="UnTip()" onmouseover="Tip('Forth is a postfix extension language')">Snd with Forth</a>
  <li><a href="#sndands7" onmouseout="UnTip()" onmouseover="Tip('s7 is yet another Scheme extension language')">Snd with s7</a>
  <li><a href="#sndandladspa" onmouseout="UnTip()" onmouseover="Tip('This is a Linux-based sound-effects plugin system')">Snd and LADSPA plugins</a>
  <li><a href="#sndandalsa" onmouseout="UnTip()" onmouseover="Tip('This is the no-longer-very-new Linux audio library')">Snd and ALSA</a>
  <li><a href="#sndandjack" onmouseout="UnTip()" onmouseover="Tip('This is the Jack audio library')">Snd and Jack</a>
  <li><a href="#sndandgl" onmouseout="UnTip()" onmouseover="Tip('OpenGL (Mesa) extensions via gl.c')">Snd and OpenGL</a>
  <li><a href="#sndandgsl" onmouseout="UnTip()" onmouseover="Tip('include some special functions from GSL')">Snd and GSL</a>
  <li><a href="#sndandgmp" onmouseout="UnTip()" onmouseover="Tip('include multiprecision arithmetic')">Snd and multiprecision arithmetic (gmp, mpfr, mpc)</a>
  </ul>
  <li><a href="#otherstuff">Other stuff</a>
</ul>
</td><td width="40%">
  <ul>
  <li><a href="extsnd.html#behavior">Customizing Snd's behavior</a>
    <ul>
    <li><a href="extsnd.html#sndglobalvars">Global variables</a>
    <li><a href="extsnd.html#sndgenericfuncs">Generic functions</a>
    <li><a href="extsnd.html#sndhooks" onmouseout="UnTip()" onmouseover="Tip('callbacks')">Hooks</a>
    </ul>
  <li><a href="extsnd.html#sndobjects">Snd's objects</a>
    <ul>
    <li><a href="extsnd.html#samplers" onmouseout="UnTip()" onmouseover="Tip('sound data iterators', WIDTH, 200)">Samplers</a>
    <li><a href="extsnd.html#Vcts" onmouseout="UnTip()" onmouseover="Tip('real arrays', WIDTH, 100)">Vcts</a>
    <li><a href="extsnd.html#sndsounddata" onmouseout="UnTip()" onmouseover="Tip('arrays of vcts for multichannel data')">Sound-data</a>
    <li><a href="extsnd.html#extsndlib" onmouseout="UnTip()" onmouseover="Tip('the underlying library that handles sound data and files')">Sndlib</a>
    <li><a href="extsnd.html#sndmarks" onmouseout="UnTip()" onmouseover="Tip('location markers in sound data')">Marks</a>
    <li><a href="extsnd.html#sndmixes" onmouseout="UnTip()" onmouseover="Tip('mixed sounds and groups of mixed sounds')">Mixes</a>
    <li><a href="extsnd.html#sndregions" onmouseout="UnTip()" onmouseover="Tip('selected or saved portions of sound data')">Regions and Selections</a>
    <li><a href="extsnd.html#sndsounds" onmouseout="UnTip()" onmouseover="Tip('editing functions, per-channel display decisions, etc')">Sounds and channels</a>
      <ul>
        <li><a href="extsnd.html#customcontrols" onmouseout="UnTip()" onmouseover="Tip('a set of common sound effects below the main graph')">the control panel</a>
        <li><a href="extsnd.html#editlists" onmouseout="UnTip()" onmouseover="Tip('current edit sequence', WIDTH, 200)">edit lists</a>
      </ul>
    <li><a href="extsnd.html#sndtransforms" onmouseout="UnTip()" onmouseover="Tip('Fourier transform, wavelets, autocorelation, etc')">Transforms</a>
    <li><a href="extsnd.html#snddialogs" onmouseout="UnTip()" onmouseover="Tip('customizing the built-in dialogs, etc')">Dialogs and Other Widgets</a>
    <li><a href="extsnd.html#sndmisc" onmouseout="UnTip()" onmouseover="Tip('bind-key, exit, etc')">Miscellaneous functions</a>
    <li><a href="extsnd.html#sndconstants">Constants</a>
    <li><a href="extsnd.html#snderrors">Errors and Debugging</a>
    </ul>
  <li><a href="extsnd.html#appearance">Customizing Snd's appearance</a>
    <ul>
    <li><a href="extsnd.html#colors">Colors</a>
    <li><a href="extsnd.html#fonts">Fonts</a>
    <li><a href="extsnd.html#graphics" onmouseout="UnTip()" onmouseover="Tip('write your own sound display functions or customize Snd\'s')">Graphics</a>
    </ul>
  </ul>

</td></tr></table>
<br>

<!-- INDEX sndandruby:Ruby -->
<!-- INDEX sndandforth:Forth -->
<!-- INDEX sndwithcm:Common Music -->

<table border=0 bordercolor="lightgreen" width=100% cellpadding=1 cellspacing=0><tr><td bgcolor="lightgreen">
<table width="100%" border=0><tr><td bgcolor="beige" align="center" valign="middle"><h2><A NAME="startup">Snd Startup</a></h2></td></tr></table>
</td></tr></table>

<br>
<!-- INDEX sndswitches:Invocation flags -->
<table width="80%" border=0><tr><td bgcolor="lightsteelblue" valign="middle"><h3><A NAME="sndswitches">Snd invocation flags</a></h3></td></tr></table>

<p>Snd recognizes the following switches in its command line:
</p>

<table border=2 bordercolor="#f2f4ff" cellpadding=6 hspace=10><tr><td>
<table cellspacing=0 cellpadding=0 hspace=20>
<tr><td width=200 bgcolor="#f2f4ff"><code>-h -horizontal</code></td><td bgcolor="#f2f4ff">layout sounds as horizontal panes</td></tr>
<tr><td><code>-v -vertical</code></td>            <td>layout sounds vertically (the default)</td></tr>
<tr><td bgcolor="#f2f4ff"><code>-notebook</code></td>               <td bgcolor="#f2f4ff">layout sounds in a notebook widget (Motif 2.0 or later)</td></tr>
<tr><td><code>-separate</code></td>               <td>layout sounds each in a separate window (listener is in main window)</td></tr>
<tr><td bgcolor="#f2f4ff"><code>--help</code></td>                  <td bgcolor="#f2f4ff">print some help, version info, and exit</td></tr>
<tr><td><code>--version</code></td>               <td>print version info</td></tr>
<tr><td bgcolor="#f2f4ff"><code>-noglob</code></td>                 <td bgcolor="#f2f4ff">don't read /etc/snd.conf</td></tr>
<tr><td><code>-noinit</code></td>                 <td>don't read ~/.snd</td></tr>
<tr><td bgcolor="#f2f4ff"><code>-nostdin</code></td>                <td bgcolor="#f2f4ff">don't watch for possible input from stdin</td></tr>
<tr><td><code>-p -preload &lt;dir&gt;</code></td> <td>add sound files in directory &lt;dir&gt; to the View:Files list (snd -p .)</td></tr>
<tr><td bgcolor="#f2f4ff"><code>-l -load &lt;file&gt;</code></td>   <td bgcolor="#f2f4ff">load Scheme, Ruby, or Forth code in &lt;file&gt; (snd -l test.scm)</td></tr>
<tr><td><code>-e -eval expr</code></td>           <td>evaluate expr</td></tr>
<tr><td bgcolor="#f2f4ff"><code>-b -batch &lt;file&gt;</code></td>  <td bgcolor="#f2f4ff">load Scheme, Ruby, or Forth code in &lt;file&gt; as a batch (no GUI) job</td></tr>
<tr><td><code>-I &lt;dir&gt;</code></td>          <td>add &lt;dir&gt; to the load search list</td></tr>
</table>
</td></tr></table>

<table border=0 hspace=20 vspace=20>
<tr>
<td><img src="pix/note.png" alt="notebook"></td>
<td width=40></td>
<td>
<pre>
snd -notebook oboe.snd pistol.snd
(set! (<a class=quiet href="extsnd.html#graphstyle" onmouseout="UnTip()" onmouseover="Tip(extsnd_graphstyle_tip)">graph-style</a>) graph-lollipops)
(set! (<a class=quiet href="extsnd.html#dotsize" onmouseout="UnTip()" onmouseover="Tip(extsnd_dotsize_tip)">dot-size</a>) 8)
</pre>
</td>
</tr>
</table>


<p>
The -e switch evaluates its argument.  The
initialization file, if any, is loaded first, then the arguments are processed
in order:</p>
<pre>
    snd -e "(set! (<a class=quiet href="extsnd.html#datacolor" onmouseout="UnTip()" onmouseover="Tip(extsnd_datacolor_tip)">data-color</a>) (<a class=quiet href="extsnd.html#makecolor" onmouseout="UnTip()" onmouseover="Tip(extsnd_makecolor_tip)">make-color</a> 1 0 0))" oboe.snd
</pre>
<p>reads ~/.snd, if any, then sets the (unselected) data color to red, then opens oboe.snd.</p>
<pre>
    snd -eval '(begin (display (+ 1 2)) (<a class=quiet href="extsnd.html#exit" onmouseout="UnTip()" onmouseover="Tip(extsnd_exit_tip)">exit</a>))'
</pre>
<p>prints "3" and exits.  The "-title" argument works in both versions of Snd.
The following adds "WAV" to the sound file extension table before adding all the sound files in the directory to the
View:Files dialog's list:
</p>
<pre>
    snd -e '(<a class=quiet href="extsnd.html#addsoundfileextension" onmouseout="UnTip()" onmouseover="Tip(extsnd_addsoundfileextension_tip)">add-sound-file-extension</a> "WAV")' -p /home/bil/sounds
</pre>


<table border=0 hspace=20 vspace=10>
<tr>
<td><img src="pix/bgd.png" alt="black background"></td>
<td width=20></td>
<td>
<pre>
snd oboe.snd
(set! (<a class=quiet href="extsnd.html#selecteddatacolor" onmouseout="UnTip()" onmouseover="Tip(extsnd_selecteddatacolor_tip)">selected-data-color</a>) (<a class=quiet href="extsnd.html#makecolor" onmouseout="UnTip()" onmouseover="Tip(extsnd_makecolor_tip)">make-color</a> 1 1 1))
(set! (<a class=quiet href="extsnd.html#selectedgraphcolor" onmouseout="UnTip()" onmouseover="Tip(extsnd_selectedgraphcolor_tip)">selected-graph-color</a>) (<a class=quiet href="extsnd.html#makecolor" onmouseout="UnTip()" onmouseover="Tip(extsnd_makecolor_tip)">make-color</a> 0 0 0))
(set! (<a class=quiet href="extsnd.html#graphshorizontal" onmouseout="UnTip()" onmouseover="Tip(extsnd_graphshorizontal_tip)">graphs-horizontal</a>) #f)
(set! (<a class=quiet href="extsnd.html#transformgraphp" onmouseout="UnTip()" onmouseover="Tip(extsnd_transformgraphp_tip)">transform-graph?</a>) #t)
(set! (<a class=quiet href="extsnd.html#showtransformpeaks" onmouseout="UnTip()" onmouseover="Tip(extsnd_showtransformpeaks_tip)">show-transform-peaks</a>) #t)
</pre>
</td>
</tr>
</table>


<br>
<br>

<!-- INDEX sndinitfile:Initialization file -->
<table width="80%" border=0><tr><td bgcolor="lightsteelblue" valign="middle"><h3><A NAME="sndinitfile">The initialization file</a></h3></td></tr></table>
<p>
When Snd starts, it looks for an initialization file, normally named "~/.snd".
This optional file is
supposed to be similar to Emacs' .emacs file, containing any customizations or
extensions that you want loaded whenever Snd starts.  Say we
want the Snd window to start out 800x500, want to predefine an envelope named
"env1", and want the file selection box to
show just sound files.  We make ~/.snd and put in it:</p>
<pre>
Scheme:
    (set! (<a class=quiet href="extsnd.html#windowwidth" onmouseout="UnTip()" onmouseover="Tip(extsnd_windowwidth_tip)">window-width</a>) 800)
    (set! (<a class=quiet href="extsnd.html#windowheight" onmouseout="UnTip()" onmouseover="Tip(extsnd_windowheight_tip)">window-height</a>) 500)
    (set! (<a class=quiet href="extsnd.html#justsounds" onmouseout="UnTip()" onmouseover="Tip(extsnd_justsounds_tip)">just-sounds</a>) #t)
    (<a class=quiet href="extsnd.html#defineenvelope" onmouseout="UnTip()" onmouseover="Tip(extsnd_defineenvelope_tip)">define-envelope</a> env1 '(0 0 1 1 2 0))

Ruby:
    set_window_width(800)
    set_window_height(500)
    set_just_sounds(true)
    define_envelope("env1", [0, 0, 1, 1, 2, 0])

Forth:
    800 set-window-width drop
    500 set-window-height drop
    #t set-just-sounds drop
    $" env1" '( 0.0 0.0 1.0 1.0 2.0 0.0 ) 1.0 define-envelope drop
</pre>

<p>
In more
complex situations, you may want an initialization file particular to a given extension language, machine, or
global across users;  the 
name of this optional global initialization file is "/etc/snd.conf". It
is read before your local file; both can, of course, be
absent.  To override reading the global init file when Snd is invoked, include the switch -noglob.
To override the local init file, use -noinit. 
</p>
<p>
The initialization files particular to a given extension language have names such as ~/.snd_s7
and ~/.snd_prefs_ruby.  Currently the possibilities are:
~/.snd_prefs_ruby|forth|s7, /etc/snd_ruby|forth|s7.conf,
~/.snd_ruby|forth|s7 (the notation "ruby|forth" means either "ruby" or "forth", so the file names
spelled out completely are "/etc/snd_ruby.conf", etc; which one is loaded
obviously depends on which language you chose during configuration).  
The save-options (preferences dialog) process writes to
.snd_prefs_* which is loaded first, if it exists; then Snd looks for .snd_* (s7, ruby, or forth);
then .snd.  If you're always using just one version of Snd, it's simplest to stick with
.snd.  The actual load sequence is:
</p>
<pre>
    /etc/snd_ruby|forth|s7.conf    (these two canceled by -noglob)
    /etc/snd.conf               
    ~/.snd_prefs_ruby|forth|s7     (the rest canceled by -noinit)
    ~/.snd_ruby|forth|s7
    ~/.snd                         (also SND_INIT_FILE_ENVRIONMENT_NAME)
</pre>

<p> 
Here's a more elaborate initialization file (~/.snd_s7):
</p>

<table border=0 cellpadding=5 hspace=20><tr><td><pre>
(set! (<a class=quiet href="extsnd.html#windowwidth" onmouseout="UnTip()" onmouseover="Tip(extsnd_windowwidth_tip)">window-width</a>) 800)           ;these set the initial window size
(set! (<a class=quiet href="extsnd.html#windowheight" onmouseout="UnTip()" onmouseover="Tip(extsnd_windowheight_tip)">window-height</a>) 500)

(if (provided? '<a class=quiet href="#sndmotiffeature">snd-motif</a>)          ;Motif and Gtk use different font naming conventions
    (begin
      (set! (<a class=quiet href="extsnd.html#listenerfont" onmouseout="UnTip()" onmouseover="Tip(extsnd_listenerfont_tip)">listener-font</a>) "9x15")
      (set! (<a class=quiet href="extsnd.html#axislabelfont" onmouseout="UnTip()" onmouseover="Tip(extsnd_axislabelfont_tip)">axis-label-font</a>) "-*-times-medium-r-normal-*-18-*-*-*-*-*-*-*")
      (set! (<a class=quiet href="extsnd.html#axisnumbersfont" onmouseout="UnTip()" onmouseover="Tip(extsnd_axisnumbersfont_tip)">axis-numbers-font</a>) "9x15"))
    (begin
      (set! (<a class=quiet href="extsnd.html#listenerfont" onmouseout="UnTip()" onmouseover="Tip(extsnd_listenerfont_tip)">listener-font</a>) "Sans 10")
      (set! (<a class=quiet href="extsnd.html#axislabelfont" onmouseout="UnTip()" onmouseover="Tip(extsnd_axislabelfont_tip)">axis-label-font</a>) "Times Medium 14")
      (set! (<a class=quiet href="extsnd.html#axisnumbersfont" onmouseout="UnTip()" onmouseover="Tip(extsnd_axisnumbersfont_tip)">axis-numbers-font</a>) "Sans 10")))

(set! (<a class=quiet href="extsnd.html#listenerprompt" onmouseout="UnTip()" onmouseover="Tip(extsnd_listenerprompt_tip)">listener-prompt</a>) ":")        ;change listener prompt from the default "&gt;" to ":"
(set! (<a class=quiet href="extsnd.html#showlistener" onmouseout="UnTip()" onmouseover="Tip(extsnd_showlistener_tip)">show-listener</a>) #t)           ;include the listener window initially

(define beige (<a class=quiet href="extsnd.html#makecolor" onmouseout="UnTip()" onmouseover="Tip(extsnd_makecolor_tip)">make-color</a> 0.96 0.96 0.86))
(define blue (<a class=quiet href="extsnd.html#makecolor" onmouseout="UnTip()" onmouseover="Tip(extsnd_makecolor_tip)">make-color</a> 0 0 1))
(set! (<a class=quiet href="extsnd.html#selectedgraphcolor" onmouseout="UnTip()" onmouseover="Tip(extsnd_selectedgraphcolor_tip)">selected-graph-color</a>) beige) ;selected graph background is beige
(set! (<a class=quiet href="extsnd.html#selecteddatacolor" onmouseout="UnTip()" onmouseover="Tip(extsnd_selecteddatacolor_tip)">selected-data-color</a>) blue)   ;selected graph data is blue

(set! (<a class=quiet href="extsnd.html#savedir" onmouseout="UnTip()" onmouseover="Tip(extsnd_savedir_tip)">save-dir</a>) "/zap/snd")        ;save-state files are placed in /zap/snd
(set! (<a class=quiet href="extsnd.html#tempdir" onmouseout="UnTip()" onmouseover="Tip(extsnd_tempdir_tip)">temp-dir</a>) "/zap/tmp")        ;temp files are placed in /zap/tmp
(set! (peak-env-dir) "~/peaks")

(load "hooks.scm")
(load "extensions.scm")

(set! (with-inset-graph) #t)        ;display an overview of the current window in the upper right
(set! (with-pointer-focus) #t)      ;automatically focus on (activate) the widget under the mouse

(hook-push <a class=quiet href="extsnd.html#afteropenhook" onmouseout="UnTip()" onmouseover="Tip(extsnd_afteropenhook_tip)">after-open-hook</a>          ;if sound has many chans, use just one pane for all
  (lambda (snd)
    (if (&gt; (<a class=quiet href="extsnd.html#chans" onmouseout="UnTip()" onmouseover="Tip(extsnd_chans_tip)">channels</a> snd) 4)
        (set! (<a class=quiet href="extsnd.html#channelstyle" onmouseout="UnTip()" onmouseover="Tip(extsnd_channelstyle_tip)">channel-style</a> snd) <a class=quiet href="extsnd.html#channelstyle" onmouseout="UnTip()" onmouseover="Tip(extsnd_channelstyle_tip)">channels-combined</a>))))

(set! (<a class=quiet href="extsnd.html#selectioncreatesregion" onmouseout="UnTip()" onmouseover="Tip(extsnd_selectioncreatesregion_tip)">selection-creates-region</a>) #f) ;turn off automatic region creation
</pre></td></tr></table>

<p>A similar Ruby initialization file (~/.snd_ruby):
</p>
<table border=0 cellpadding=5 hspace=20><tr><td><pre>
require "draw"

set_window_width 800
set_window_height 500

set_listener_font "9x15"
set_axis_numbers_font "9x15"

set_show_mix_waveforms true
set_trap_segfault false
set_listener_prompt ":"
set_show_listener true

beige = make_color 0.96, 0.96, 0.86
blue = make_color 0, 0, 1
set_selected_graph_color beige
set_selected_data_color blue
make_current_window_display

$mouse_enter_graph_hook.add_hook!("focus") do |snd, chn|
  focus_widget(channel_widgets(snd, chn)[0])
end
$mouse_enter_listener_hook.add_hook!("focus") do |widget| focus_widget(widget) end
$mouse_enter_text_hook.add_hook!("focus") do |widget| focus_widget(widget) end
</pre></td></tr></table>

<p>And Forth (~/.snd_forth):
</p>

<table border=0 cellpadding=5 hspace=20><tr><td>
<pre>
\ .snd_forth -- start up file for Snd/Forth -*- snd-forth -*-

\ You can install the *.fs scripts with:
\ 
\   cd ${top_srcdir}/examples/site-lib
\   ./install.fth
\ 
\ or even better
\
\   cd ${top_builddir}
\   make install
\
\ If you have installed *.fs scripts with one of the above mentioned
\ commands, you don't need to add a path to *load-path*.
\ ${prefix}/share/fth/site-fth is already included.  Otherwise you can
\ add a path with e.g.:
\ 
\   "/home/mike/snd" add-load-path

\ A special *SND-HOME* path points here to ~/.snd.d (similar to ~/.emacs.d):
\ 
\ ~/.snd.d            directory for save-state-file
\ ~/.snd.d/sound      directory for *clm-file-name*
\                                   add-directory-to-view-files-list
\                                   set-open-file-dialog-director
\ ~/.snd.d/zap        directory for set-temp-dir
\                                   set-save-dir
\ ~/.snd.d/peaks      directory for set-peak-env-dir
\
\ "HOME" getenv       value *home*
\ *home* "/.snd.d" $+ value *snd-home*
\
\ Change these paths to fit your needs!
\

#t to *fth-verbose*
#f to *fth-debug*

#f value *init-with-peaks*		\ with peak-env support
#f value *init-graph-extra-hooks*	\ with display-correlate, zoom-spectrum, superimpose-ffts
#f value *init-lisp-graph-extra-hooks*	\ with display-energy, display-db

: print-loading-file { fname -- }
  *fth-verbose* if $" \\ loading %s\n" '( fname ) clm-print then
;

*filename* print-loading-file

"HOME" getenv                     value *home*
*home* "/.snd.d"               $+ value *snd-home*
hostname                          value *hostname*
*hostname* /\\./ string-split car value *short-hostname*
*argv* length 0&gt; [if] *argv* car undef file-basename [else] "snd" [then] value *program-name*

before-load-hook lambda: &lt;{ fname -- f }&gt;
  fname print-loading-file
  #t
; add-hook!

\ if configured --with-shared-sndlib
dl-load sndlib Init_sndlib

\ Set them before loading clm.fs.
2                      set-default-output-chans   drop
48000    	       set-default-output-srate   drop
512                    set-dac-size               drop
mus-clipping           set-clipping               drop
1024 1024 *            set-mus-file-buffer-size   drop
24                     set-mus-array-print-length drop
mus-array-print-length set-print-length           drop
128                    set-object-print-length

require clm
require clm-ins

\ Environment variable CLM_SEARCH_PATH
\ Path variable where sound files reside.
\ csh: setenv CLM_SEARCH_PATH /usr/gnu/sound/SFiles:${HOME}/.snd.d/sound
\  sh: CLM_SEARCH_PATH=/usr/gnu/sound/SFiles:${HOME}/.snd.d/sound; export CLM_SEARCH_PATH

"CLM_SEARCH_PATH" getenv dup [if]
  ":" string-split [each] *clm-search-list* swap array-push to *clm-search-list* [end-each]
[else]
  drop
  *clm-search-list* *snd-home* "/sound" $+ array-push to *clm-search-list*
[then]
#t                                     to *clm-play*
#t                                     to *clm-statistics*
#t                                     to *clm-verbose*
#f                                     to *clm-debug*
*snd-home* "/sound/fth-test.snd"    $+ to *clm-file-name*
*snd-home* "/sound/fth-test.reverb" $+ to *clm-reverb-file-name*
#t                                     to *clm-delete-reverb*
lambda: &lt;{ ins beg dur -- }&gt; $" %14s: %5.2f %5.2f" '( ins beg dur ) clm-message ; to *clm-notehook*

'snd-nogui provided? [if]
  \ snd-nogui repl and prompt hooks
  before-repl-hook reset-hook!		\ remove default hook
  before-repl-hook lambda: &lt;{ -- }&gt;
    "" #f clm-message
    $" Starting session on %s." '( $" %Ev %Er" current-time strftime ) clm-message
    "" #f clm-message
  ; add-hook!
  after-repl-hook lambda: &lt;{ history -- }&gt;
    "" #f clm-message
    $" Thank you for using %s!" #( *program-name* string-upcase ) clm-message
    "" #f clm-message
    1 sleep
  ; add-hook!
  
  \ A more elaborated prompt for fth and snd-forth-nogui.
  before-prompt-hook lambda: &lt;{ prompt pos -- new-prompt }&gt;
    "%EI:%EM%p" current-time strftime string-downcase! { tm }
    "(/usr)?" *home* $+ make-regexp file-pwd "~" regexp-replace { path }
    $" (%s:%s)\n[%s %s] (%d)&gt; " #( *short-hostname* path *program-name* tm pos ) string-format
  ; add-hook!
[then]

*snd-home* add-load-path
*init-with-peaks* [if]
  *snd-home* "/peaks"      $+ set-peak-env-dir               drop
[then]
*snd-home* "/snd-saved.fs" $+ set-save-state-file            drop
*snd-home* "/zap"          $+ set-temp-dir                   drop
*snd-home* "/zap"          $+ set-save-dir                   drop
*snd-home* "/sound"        $+ set-open-file-dialog-directory drop
"/usr/gnu/cvs/snd"            set-html-dir                   drop
"BROWSER" getenv "firefox" || set-html-program               drop
#t                	      set-trap-segfault              drop
#t                            set-show-listener              drop
0.0               	      set-auto-update-interval       drop
"rev"           	      add-sound-file-extension       drop
"reverb"        	      add-sound-file-extension       drop
"wave"          	      add-sound-file-extension       drop
*clm-search-list* [each] ( dir ) undef add-directory-to-view-files-list drop [end-each]

before-save-state-hook lambda: &lt;{ fname -- f }&gt;
  $" \\ -*- snd-forth -*-\n" :filename fname with-output-port
  #t				      \ #t --&gt; append mode
; add-hook!

\ make-default-comment from clm.fs
output-comment-hook lambda: &lt;{ str -- s }&gt;
  str empty? if make-default-comment else str then
; add-hook!

'snd-nogui provided? [unless]
  'snd-motif provided? [if]
    \ if not configured --with-static-xm
    'xm provided? not [if] dl-load libxm Init_libxm [then]
    require snd-xm
    add-mark-pane
    #t with-smpte-label
    after-open-hook &lt;'&gt; show-disk-space add-hook!

    require effects
    #f to use-combo-box-for-fft-size	\ boolean (default #f)

    edhist-save-hook lambda: &lt;{ prc -- }&gt; "%S" #( prc ) clm-message ; add-hook!
  [then]

  'snd-gtk provided? [if]
    \ if not configured --with-static-xg
    'xg provided? not [if] dl-load libxg Init_libxg [then]
    $" Serif 10" set-axis-label-font drop
  [then]

  require extensions
  #t set-emacs-style-save-as
  #t set-ask-about-unsaved-edits
  *snd-home* "/snd-remember-sound.fs" $+ to remember-sound-filename
  3 remember-sound-state
  0.00 0.10 #t prefs-activate-initial-bounds
  with-buffers-menu
  2 set-sync-style

  require examp
  *init-graph-extra-hooks* [if]
    graph-hook         &lt;'&gt; display-correlate  add-hook!
    graph-hook         &lt;'&gt; zoom-spectrum      add-hook!
    graph-hook         &lt;'&gt; superimpose-ffts   add-hook!
  [then]
  *init-lisp-graph-extra-hooks* [if]
    lisp-graph-hook    &lt;'&gt; display-energy     add-hook!
    lisp-graph-hook    &lt;'&gt; display-db         add-hook!
  [then]
  after-transform-hook &lt;'&gt; fft-peak           add-hook!

  require mix
  mix-click-hook       &lt;'&gt; mix-click-sets-amp add-hook!
  mix-click-hook       &lt;'&gt; mix-click-info     add-hook!

  require marks
  save-mark-properties
  mark-click-hook      &lt;'&gt; mark-click-info    add-hook!

  require dsp
  graph-hook lambda: &lt;{ snd chn y0 y1 -- #f }&gt;
    $" freq: %.3f" #( snd chn left-sample  snd chn spot-freq ) string-format
    snd #f report-in-minibuffer drop
    #f
  ; add-hook!

  mouse-click-hook lambda: &lt;{ snd chn button state x y axis -- a }&gt;
    axis time-graph = if
      $" freq: %.3f" #( snd chn #f cursor  snd chn spot-freq ) string-format
      snd #f report-in-minibuffer
    else
      #f
    then
  ; add-hook!

  require env
  enved-hook lambda: &lt;{ en pt x y reason -- en'|#f }&gt;
    reason enved-move-point = if
      x en 0 array-ref f&gt; x en -2 array-ref f&lt; && if
	en en pt 2* array-ref x #f #f stretch-envelope ( new-en ) dup pt 2* 1+ y array-set!
      else
	#f
      then
    else
      #f
    then
  ; add-hook!

  require rgb
  beige                  set-selected-graph-color    drop
  blue                   set-selected-data-color     drop

  #t           	         set-show-indices            drop
  #f		         set-with-verbose-cursor     drop
  #t                     set-with-inset-graph        drop
  #t                     set-with-pointer-focus      drop
  #t  			 set-just-sounds             drop
  #t  			 set-enved-wave?             drop
  #t  			 set-show-y-zero             drop
  #t                     set-show-transform-peaks    drop
  speed-control-as-ratio set-speed-control-style     drop
  graph-as-spectrogram   set-transform-graph-type    drop \ graph-once graph-as-sonogram
  rainbow-colormap	 set-colormap                drop
  $" snd&gt; "              set-listener-prompt         drop
  160 		         set-window-x                drop
  0 			 set-window-y                drop
  800 		         set-window-width            drop
  600 		         set-window-height           drop

  exit-hook lambda: &lt;{ -- f }&gt;
    save-state-file save-state drop
    sounds each close-sound drop end-each
    #t
  ; add-hook! 

  after-open-hook lambda: &lt;{ snd -- }&gt;
    snd channels 0 ?do snd short-file-name snd i time-graph set-x-axis-label drop loop
    #t snd set-with-tracking-cursor drop
    channels-combined snd set-channel-style
  ; add-hook!

  : snd-set-cursor-style { snd kind -- #f }
    snd sound? if kind snd #t set-cursor-style drop then
    #f
  ;
  start-playing-hook lambda: &lt;{ snd -- f }&gt; snd cursor-line  snd-set-cursor-style ; add-hook!
  stop-playing-hook  lambda: &lt;{ snd -- f }&gt; snd cursor-cross snd-set-cursor-style ; add-hook!

  \ bind-key ( key modifiers func :optional extended=#f origin="" prefs-info="" -- val )
  \ 
  \ modifiers:
  \   0 normal
  \   1 shift
  \   4 control
  \   8 meta
  \ 
  \ extended (prefix key):
  \   #t  C-x
  \   #f  none
  \
  \ func ( -- val )
  \
  \ val should be:
  \   cursor-in-view
  \   cursor-on-left
  \   cursor-on-right
  \   cursor-in-middle
  \   keyboard-no-action
  \ 
  \ C-x C-c terminate Snd
  &lt;char&gt; c 4 lambda: &lt;{ -- val }&gt;
    0 snd-exit drop
    cursor-in-view
  ; #t $" terminate Snd" "terminate-snd" bind-key drop
  \ C-x k close selected sound
  &lt;char&gt; k 0 lambda: &lt;{ -- val }&gt;
    selected-sound close-sound-extend
    cursor-in-view
  ; #t $" close sound and jump to next open" "close-current-sound" bind-key drop
  \ C-x C-k show listener
  &lt;char&gt; k 4 lambda: &lt;{ -- val }&gt;
    #t set-show-listener drop
    cursor-in-view
  ; #t $" show listener" "show-listener" bind-key drop
  \ C-x C-n hide listener
  &lt;char&gt; n 4 lambda: &lt;{ -- val }&gt;
    #f set-show-listener drop
    cursor-in-view
  ; #t $" hide listener" "hide-listener" bind-key drop
  \ C-x C-x play
  &lt;char&gt; x 4 lambda: &lt;{ -- val }&gt;
    #t play drop
    cursor-in-view
  ; #t $" play current sound" "play-current-sound" bind-key drop
  \ C-x C-t play from cursor
  &lt;char&gt; t 4 lambda: &lt;{ -- val }&gt;
    selected-sound :start undef undef undef cursor play drop
    cursor-in-view
  ; #t $" play from cursor" "play-from-cursor" bind-key drop
  \ C-x x eval over selection
  &lt;char&gt; x 0 lambda: &lt;{ -- val }&gt;
    undef selection? if
      $" selection-eval:" &lt;'&gt; eval-over-selection #f #f prompt-in-minibuffer
    else
      $" no selection" #f #f report-in-minibuffer
    then drop
    cursor-in-view
  ; #t $" eval over selection" "eval-over-selection" bind-key drop
[then]					\ not snd-nogui

'snd-nogui provided? [unless]
  save-state-file file-exists? [if] require snd-saved [then]
[then]

\ find-file searchs in *clm-search-list*
sounds empty? [if]
  *clm-file-name* find-file dup [if] open-sound [then] drop cr
[then]

$" Snd of %s (Fth %s)" #( snd-version fth-version ) clm-message

\ .snd_forth ends here
</pre>
</td></tr></table>

<p>
If you loaded Snd with GSL, and have set the GSL_IEEE_MODE environment variable,
it will override Snd's default arithmetic mode settings.  GSL recommends the setting:
</p>
<pre>
    GSL_IEEE_MODE=double-precision,mask-underflow,mask-denormalized
</pre>
<p>For more complex initialization files, see snd_conffile.scm, snd_frg.scm, and edit123.scm.
</p>

<p>
Normally, the initialization file also adds the Snd sources directory to the load path.
For more temporary situations, you can use the environment variable SND_PATH.
It is a colon-separated list of directories that will be added to the load path when Snd starts.
</p>

<br><br>

<table width="80%" border=0><tr><td bgcolor="lightsteelblue" valign="middle"><h3><A NAME="sndconfigurationswitches">Configuration choices</a></h3></td></tr></table>

<p>The configuration process is controlled by a set of switches, some specific to Snd.  The
latter are (configure --help):
</p>

<table cellspacing=0 cellpadding=0>
<tr><td colspan=2></td><td width=20></td><td></td></tr>
<tr><td colspan=2 bgcolor="#EEFDEE">Audio choices</td><td></td><td>(normally this is decided automatically)</td></tr>
<tr><td width=50></td><td>--with-esd</td><td></td><td>use ESD (enlightened sound daemon)</td></tr>
<tr><td></td><td>--with-alsa</td><td></td><td>use ALSA (the default in Linux)</td></tr>
<tr><td></td><td>--with-oss</td><td></td><td>use OSS</td></tr>
<tr><td></td><td>--with-static-alsa</td><td></td><td>use ALSA statically loaded</td></tr>
<tr><td></td><td>--with-jack</td><td></td><td>use JACK (Linux audio stream sharing support, can be used with ALSA)</td></tr>
<tr><td></td><td>--with-pulseaudio</td><td></td><td>use pulseaudio (may not work yet)</td></tr>
<tr><td></td><td>--with-portaudio</td><td></td><td>use portaudio (may not work yet)</td></tr>
<tr><td colspan=2></td><td></td><td></td></tr>

<tr><td colspan=2 bgcolor="#EEFDEE">Graphics choices</td><td></td><td></td><td></td></tr>
<tr><td></td><td>--with-gtk</td><td></td><td>use Gtk+ to build Snd (Gtk+ version 2.0 or later)</td></tr>
<tr><td></td><td>--with-motif</td><td></td><td>use Motif (version 2.0 or later) to build Snd (the default), Lesstif is not supported</td></tr>
<tr><td></td><td>--with-static-motif</td><td></td><td>use libXm.a to build Snd</td></tr>
<tr><td></td><td>--with-motif-prefix=PFX</td><td></td><td>where Motif is installed (--with-motif-prefix=/usr/X11R6)</td></tr>
<tr><td></td><td>--with-no-gui</td><td></td><td>make Snd without any graphics support</td></tr>
<tr><td></td><td>--with-static-xm</td><td></td><td>include the xm module at build time; this is easier than trying to dynamically load xm.so</td></tr>
<tr><td></td><td>--with-static-xg</td><td></td><td>include the xg module at build time; this is easier than trying to dynamically load xg.so</td></tr>
<tr><td></td><td>--with-gl</td><td></td><td>include OpenGL support (spectrogram, etc, Motif only)</td></tr>
<tr><td></td><td>--with-just-gl</td><td></td><td>include OpenGL support, but omit the GL/s7/Ruby/Forth bindings (Motif only)</td></tr>
<tr><td></td><td>--with-gl2ps</td><td></td><td>include gl2ps (GL to Postscript code, Motif only)</td></tr>
<tr><td></td><td>--with-editres</td><td></td><td>include editres in xm (default: no)</td></tr>
<tr><td colspan=2></td><td></td><td></td></tr>

<tr><td colspan=2 bgcolor="#EEFDEE">Language choices</td><td></td><td></td></tr>
<tr><td></td><td>--with-forth</td><td></td><td>use Forth as the extension language</td></tr>
<tr><td></td><td>--with-ruby</td><td></td><td>use Ruby as the extension language; version 1.6.4 or later</td></tr>
<tr><td></td><td>--with-s7</td><td></td><td>use s7 as the extension language (default = yes)</td></tr>
<tr><td></td><td>--with-ruby-prefix=PFX</td><td></td><td>where Ruby is installed</td></tr>
<tr><td colspan=2></td><td></td><td></td></tr>

<tr><td colspan=2 bgcolor="#EEFDEE">Numerical choices</td><td></td><td></td></tr>
<tr><td></td><td>--with-doubles</td><td></td><td>use doubles throughout (default: yes)</td></tr>
<tr><td></td><td>--with-float-samples</td><td></td><td>use floats or doubles as the internal sample representation (default: yes)</td></tr>
<tr><td></td><td>--with-sample-width=N</td><td></td><td>if not float samples, use N bits for ints (default: 24, must be between 16 and 31)</td></tr>
<tr><td colspan=2></td><td></td><td></td></tr>

<tr><td colspan=2 bgcolor="#EEFDEE">Library choices</td><td></td><td></td></tr>
<tr><td></td><td>--with-gsl</td><td></td><td>use GSL (for Chebyshev window), default: yes if local C does not support complex trig</td></tr>
<tr><td></td><td>--with-fftw</td><td></td><td>use fftw, default: yes; fallback fft is built-in</td></tr>
<tr><td></td><td>--with-gmp</td><td></td><td>use gmp, mpfr, and mpc to implement multiprecision arithmetic (default: no)</td></tr>
<tr><td></td><td>--with-fam</td><td></td><td>use libfam (Gamin), default: yes; fallback is polling via <a href="extsnd.html#autoupdateinterval">auto-update-interval</a></td></tr>
<tr><td></td><td>--with-ladspa</td><td></td><td>include support for LADSPA plugins (in Linux default: yes)</td></tr>
<tr><td></td><td>--with-shared-sndlib</td><td></td><td>try to load libsndlib.so, rather than building it into Snd (default: no)</td></tr>
<tr><td></td><td>--disable-deprecated</td><td></td><td>do not include any deprecated stuff from gtk, s7, sndlib, xen, clm, etc</td></tr>
<tr><td colspan=2></td><td></td><td></td></tr>

<tr><td colspan=2 bgcolor="#EEFDEE">Directory choices</td><td></td><td></td></tr>
<tr><td></td><td>--with-temp-dir</td><td></td><td>directory to use for temp files (default: ".")</td></tr>
<tr><td></td><td>--with-save-dir</td><td></td><td>directory to use for saved-state files (default: ".")</td></tr>
<tr><td></td><td>--with-doc-dir</td><td></td><td>directory to search for documentation (html-dir, elaborate set of defaults)</td></tr>
<tr><td colspan=2></td><td></td><td></td></tr>

<tr><td colspan=2 bgcolor="#EEFDEE">Debugging etc</td><td></td><td></td></tr>
<tr><td></td><td>--with-snd-as-widget</td><td></td><td>make Snd a loadable widget, not a standalone program</td></tr>
<tr><td></td><td>--with-profiling</td><td></td><td>include profiling (branch counting) machinery, default: no (only for s7)</td></tr>
<tr><td></td><td>--enable-snd-debug</td><td></td><td>include internal Snd debugging functions, default: no (not useful if not actually debugging!) </td></tr>
<tr><td></td><td>--disable-largefile</td><td></td><td>omit support for large (64-bit byte address) files</td></tr>
<tr><td colspan=2></td><td></td><td></td></tr>
</table>

<pre>
  ./configure
  make
  make install
</pre>
<p>tries to use s7, Motif, ALSA (if Linux), and a float sample representation, then
installs the snd executable in /usr/local/bin, with a brief blurb
in /usr/local/man/man1.
Here at CCRMA, we normally use:
</p>
<pre>
  ./configure --with-alsa --with-temp-dir=/zap --with-static-xm --with-gl
</pre>

<p>
There are many more examples in tools/compsnd.
Don't use the --enable-snd-debug switch unless you know what you are asking for!
Depending on how Snd is configured, any of the following symbols may be "provided"
(on the *features* list in Scheme):
</p>
<table hspace=20 border=1>
<tr><td>
<table>
<tr><td width=100>clm</td><td>clm module (always included &mdash; once upon a time it was optional)</td></tr>
<tr><td bgcolor="#f2f4ff">gl</td><td bgcolor="#f2f4ff">OpenGL callable from Scheme/Ruby/Forth (--with-gl switch)</td></tr>
<tr><td>snd-ladspa</td><td>LADSPA loaded (--with-ladspa, but also the default in Linux if ladspa.h can be found)</td></tr>
<tr><td bgcolor="#f2f4ff">sndlib</td><td bgcolor="#f2f4ff">sndlib module (always included)</td></tr>
<tr><td><A NAME="sndmotiffeature">snd-motif</a></td><td>Motif used as GUI toolkit (--with-motif, usually the default if Motif can be found)</td></tr>
<tr><td bgcolor="#f2f4ff"><A NAME="sndgtkfeature">snd-gtk</a></td><td bgcolor="#f2f4ff">Gtk+ used as GUI toolkit (--with-gtk)</td></tr>
<tr><td>snd-nogui</td><td>No GUI built-in (--with-no-gui, or neither Motif nor Gtk+ found)</td></tr>
<tr><td>snd-ruby</td><td>Ruby as extension language (--with-ruby)</td></tr>
<tr><td bgcolor="#f2f4ff">snd-forth</td><td bgcolor="#f2f4ff">Forth as extension language (--with-forth)</td></tr>
<tr><td>snd-s7</td><td>s7 as extension language (--with-s7)</td></tr>
<tr><td bgcolor="#f2f4ff">snd-debug</td><td bgcolor="#f2f4ff">internal debugging hooks included (--enable-snd-debug)</td></tr>
<tr><td>snd</td><td>It's Snd, ferchrissake... (always included)</td></tr>
<tr><td bgcolor="#f2f4ff">xg</td><td bgcolor="#f2f4ff">Gtk module (xg.c) included (--with-static-xg, or loaded dynamically)</td></tr>
<tr><td bgcolor="#f2f4ff">xm</td><td bgcolor="#f2f4ff">Motif module (xm.c) included (--with-static-xm, or loaded dynamically)</td></tr>
<tr><td>alsa</td><td>ALSA is in use, rather than OSS (--with-alsa)</td></tr>
<tr><td bgcolor="#f2f4ff">gsl</td><td bgcolor="#f2f4ff">GSL is loaded (--with-gsl)</td></tr>
<tr><td>gl2ps</td><td>gl2ps is included (--with-gl2ps)</td></tr>
</table>
</td></tr>
</table>

<p>To check whether something is available in the current Snd, use:
</p>
<pre>
    Scheme:  (provided? 'snd-gtk)
    Ruby:    provided? :snd-gtk
    Forth:   "snd-gtk" defined?
</pre>
<br>

<table width="80%" border=0><tr><td bgcolor="lightsteelblue" valign="middle"><h3><A NAME="sndenvvars">Environment variables</a></h3></td></tr></table>

<p>There are several environment variables specific to Snd:
</p>
<table hspace=20>
<tr><td width=300>SND_PATH</td><td>Snd source load path list (a colon separated directory list)</td></tr>
<tr><td bgcolor="#f2f4ff">SND_INIT_FILE_ENVIRONMENT_NAME</td><td bgcolor="#f2f4ff">init file name</td></tr>
<tr><td>LADSPA_PATH</td><td>Ladspa modules directory</td></tr>
<tr><td bgcolor="#f2f4ff">MUS_ALSA_PLAYBACK_DEVICE</td><td bgcolor="#f2f4ff">name of playback device (Alsa only)</td></tr>
<tr><td>MUS_ALSA_CAPTURE_DEVICE</td><td>name of capture device (Alsa only)</td></tr>
<tr><td bgcolor="#f2f4ff">MUS_ALSA_DEVICE</td><td bgcolor="#f2f4ff">name of the playback and capture device (Alsa only)</td></tr>
<tr><td>MUS_ALSA_BUFFERS</td><td>number of "periods" used (Alsa only)</td></tr>
<tr><td bgcolor="#f2f4ff">MUS_ALSA_BUFFER_SIZE</td><td bgcolor="#f2f4ff">number of samples per channel per buffer (Alsa only)</td></tr>
<tr><td>AUDIODEV</td><td>audio device name (Sun and related drivers)</td></tr>
</table>

<br>

<table border=0 bordercolor="lightgreen" width=100% cellpadding=1 cellspacing=0><tr><td bgcolor="lightgreen">
<table width="100%" border=0><tr><td bgcolor="beige" align="center" valign="middle"><h2><A NAME="snddynamic">Runtime modules and external programs</a></h2></td></tr></table>
</td></tr></table>
<br>

<!-- INDEX emacssnd:Emacs and Snd -->
<table width="100%" border=0><tr><td bgcolor="lightsteelblue" valign="middle"><h3><A NAME="emacssnd">Snd as an Emacs subjob</a></h3></td></tr></table>

<p>Snd watches stdin; any input received
is evaluated as if typed in Snd's listener; any subsequent output
is sent to stdout.  Presumably any process could communicate with
Snd in this manner,  but the real reason for this is to make it possible to run Snd as a subjob of Emacs.
The simplest way to enable that is to use <a href="sndscm.html#dotemacs">inf-snd.el</a> by Michael
Scholz.  It starts with a long and detailed commentary.
</p>
<br>
<table width="80%" border=0><tr><td bgcolor="lightsteelblue" valign="middle"><h3><A NAME="dynamic">Dynamically loaded modules</a></h3></td></tr></table>

<p>You can import shared object files into Snd at any time.
</p>
<pre>
  (define lib (<em class=red>dynamic-link</em> "/home/bil/cl/cscm.so"))
  (<em class=red>dynamic-call</em> "init_hiho" lib)
</pre>


<br>
<table width="80%" border=0><tr><td bgcolor="lightsteelblue" valign="middle"><h3><A NAME="sndaswidget">Snd as a Widget</a></h3></td></tr></table>

<p>To include the entire Snd editor as a widget in some other program,
first compile it with -DSND_AS_WIDGET. Then load it into your program,
using the procedure <b>snd_as_widget</b> to fire it up.  See
saw.c included with Snd.
</p>

<pre>
  void snd_as_widget(int argc, char **argv, XtAppContext app, Widget parent, Arg *caller_args, int caller_argn)
</pre>

<p>starts up the Snd editor in the widget 'parent', passing the outer Snd
form widget the arguments 'caller_args' and 'caller_argn'.  The
enclosing application context is 'app'.  'parent' needs to
be realized at the time of the call, since Snd uses it to set up graphics
contexts and so on.  'argc' and 'argv' can be passed to
simulate a shell invocation of Snd.  Remember that in this case, the
first string argument is expected to be the application name, and is
ignored by Snd.
In Gtk, the arguments are different, but the basic idea is the same:
</p>
<pre>
  GtkWidget *snd_as_widget(int argc, char **argv, GtkWidget *parent, void (*error_func)(const char *msg))
</pre>


<br>
<table width="80%" border=0><tr><td bgcolor="lightsteelblue" valign="middle"><h3><A NAME="sndwithclm">Snd and CLM</a></h3></td></tr></table>

<p>The files clm.c, clm.h, and clm2xen.c implement <a href="sndclm.html#sndclmtop">CLM</a> (a Music V implementation),
always included in Snd.
You can see what a generator does, or a group of generators, by running them in the
listener, and using the graph and spectrum functions.  Say we have
these declarations in ~/.snd:
</p>

<table border=0 cellpadding=5 hspace=20><tr><td><pre>
(define data-size 1024)
(define data (<a class=quiet href="extsnd.html#makevct" onmouseout="UnTip()" onmouseover="Tip(extsnd_makevct_tip)">make-vct</a> data-size))

(define (run-gen func)        ; func is a function of no arguments (a "thunk")
  (do ((i 0 (+ 1 i))) 
      ((= i data-size))
    (set! (data i) (func))) ; fill data vct with output of 'func'
  (<a class=quiet href="extsnd.html#graph" onmouseout="UnTip()" onmouseover="Tip(extsnd_graph_tip)">graph</a> data))               ; display data as a graph

(define (run-fft func)
  (do ((i 0 (+ 1 i))) 
      ((= i data-size))
    (set! (data i) (func)))
  (<a class=quiet href="extsnd.html#graph" onmouseout="UnTip()" onmouseover="Tip(extsnd_graph_tip)">graph</a> (<a class=quiet href="extsnd.html#sndspectrum" onmouseout="UnTip()" onmouseover="Tip(extsnd_sndspectrum_tip)">snd-spectrum</a> data blackman2-window data-size #t)))
</pre></td></tr></table>

<p>Now we can open the listener, and type:</p>
<pre>
    (define hi (<a class=quiet href="sndclm.html#make-oscil" onmouseout="UnTip()" onmouseover="Tip(sndclm_make_oscil_tip)">make-oscil</a>))
    (run-gen (lambda () (<a class=quiet href="sndclm.html#oscil" onmouseout="UnTip()" onmouseover="Tip(sndclm_oscil_tip)">oscil</a> hi)))
    (define ho (<a class=quiet href="sndclm.html#make-oscil" onmouseout="UnTip()" onmouseover="Tip(sndclm_make_oscil_tip)">make-oscil</a>))
    (run-fft (lambda () (<a class=quiet href="sndclm.html#oscil" onmouseout="UnTip()" onmouseover="Tip(sndclm_oscil_tip)">oscil</a> hi (* .5 (<a class=quiet href="sndclm.html#oscil" onmouseout="UnTip()" onmouseover="Tip(sndclm_oscil_tip)">oscil</a> ho)))))
</pre>
<p>Any CLM instrument or function can be used in this way 
to edit sounds.  Say we want an echo effect:</p>

<table border=0 cellpadding=5 hspace=20><tr><td><pre>
(define echo 
  (lambda (scaler secs)
    (let ((del (<a class=quiet href="sndclm.html#make-delay" onmouseout="UnTip()" onmouseover="Tip(sndclm_make_delay_tip)">make-delay</a> (round (* secs (<a class=quiet href="extsnd.html#srate" onmouseout="UnTip()" onmouseover="Tip(extsnd_srate_tip)">srate</a>))))))
      (lambda (inval)
        (+ inval (<a class=quiet href="sndclm.html#delay" onmouseout="UnTip()" onmouseover="Tip(sndclm_delay_tip)">delay</a> del (* scaler (+ (<a class=quiet href="sndclm.html#tap" onmouseout="UnTip()" onmouseover="Tip(sndclm_tap_tip)">tap</a> del) inval))))))))
</pre></td></tr></table>

<p>
Here 'scaler' sets
how loud subsequent echos are, and 'secs' sets how far apart they
are in seconds.  'echo' uses the 'secs' argument to create
a delay line (<a href="sndclm.html#make-delay">make-delay</a>) using the current sound's
sampling rate to turn the 'secs' parameter into samples.
echo then returns a closure, that is, a function with
associated variables (in this case 'del' and 'scaler');
the returned function (the second lambda) takes
one argument ('inval') and returns the result of passing
that value to the delay with scaling.  The upshot of all this is that
we can use:</p>
<pre>
    (<a class=quiet href="extsnd.html#mapchannel" onmouseout="UnTip()" onmouseover="Tip(extsnd_mapchannel_tip)">map-channel</a> (echo .5 .75) 0 44100)
</pre>

<p>to take the current active channel and 
return 44100 samples of echos, each echo half the amplitude
of the previous, and spaced by .75 seconds.  map-channel's
first argument is a function of one argument, the current sample;
when we pass it <code>(echo ...)</code>, it evaluates the echo call,
which returns the function that actually runs the delay line,
producing the echo. 
</p> 
<p>If we want "pre-echoes" instead (echoes of the future):
</p>
<pre>
    (<a class=quiet href="extsnd.html#reversesound" onmouseout="UnTip()" onmouseover="Tip(extsnd_reversesound_tip)">reverse-sound</a>)
    (<a class=quiet href="extsnd.html#mapchannel" onmouseout="UnTip()" onmouseover="Tip(extsnd_mapchannel_tip)">map-channel</a> (echo .5 .75) 0 44100)
    (<a class=quiet href="extsnd.html#reversesound" onmouseout="UnTip()" onmouseover="Tip(extsnd_reversesound_tip)">reverse-sound</a>)
</pre>

<p>Generators are "applicable" in most versions of Snd: the generator knows its type, so the
explicit "oscil" function (for example) isn't needed.
</p>
<pre>
    &gt;<em class=typing>(define hi (make-oscil 440.0))</em>
    <em class=listener>#&lt;unspecified&gt;</em>
    &gt;<em class=typing>(hi)</em>
    <em class=listener>0.0</em>
    &gt;<em class=typing>(oscil hi)</em>
    <em class=listener>0.125050634145737</em>
</pre>

<p>
We can make a generator that is either
an oscil or a sawtooth-wave:
</p>
<pre>
    &gt;<em class=typing>(define sine-or-sawtooth
       (lambda (sine)
         (let ((gen ((if sine make-oscil make-sawtooth-wave) 440.0)))
           (lambda (fm)
             (gen fm)))))</em>
    <em class=listener>#&lt;unspecified&gt;</em>
    &gt;<em class=typing>(define osc (sine-or-sawtooth #t))</em>
    <em class=listener>#&lt;unspecified&gt;</em>
    &gt;<em class=typing>(osc 0.0)</em>
    <em class=listener>0.0</em>
    &gt;<em class=typing>(osc 0.0)</em>
    <em class=listener>0.125050634145737</em>
</pre>

<p>Here are a few more examples, taken from <a href="sndscm.html#exampdoc">examp.scm</a>.
</p>
<pre>
(define comb-filter 
  (lambda (scaler size)
    (let ((cmb (<a class=quiet href="sndclm.html#make-comb" onmouseout="UnTip()" onmouseover="Tip(sndclm_make_comb_tip)">make-comb</a> scaler size)))
      (lambda (x) (<a class=quiet href="sndclm.html#comb" onmouseout="UnTip()" onmouseover="Tip(sndclm_comb_tip)">comb</a> cmb x)))))

; (<a class=quiet href="extsnd.html#mapchannel" onmouseout="UnTip()" onmouseover="Tip(extsnd_mapchannel_tip)">map-channel</a> (comb-filter .8 32))

;;; by using filters at harmonically related sizes, we can get chords:

(define comb-chord
  (lambda (scaler size amp)
    (let ((c1 (<a class=quiet href="sndclm.html#make-comb" onmouseout="UnTip()" onmouseover="Tip(sndclm_make_comb_tip)">make-comb</a> scaler size))
	  (c2 (<a class=quiet href="sndclm.html#make-comb" onmouseout="UnTip()" onmouseover="Tip(sndclm_make_comb_tip)">make-comb</a> scaler (* size .75)))
	  (c3 (<a class=quiet href="sndclm.html#make-comb" onmouseout="UnTip()" onmouseover="Tip(sndclm_make_comb_tip)">make-comb</a> scaler (* size 1.2))))
      (lambda (x)
        (* amp (+ (<a class=quiet href="sndclm.html#comb" onmouseout="UnTip()" onmouseover="Tip(sndclm_comb_tip)">comb</a> c1 x) (<a class=quiet href="sndclm.html#comb" onmouseout="UnTip()" onmouseover="Tip(sndclm_comb_tip)">comb</a> c2 x) (<a class=quiet href="sndclm.html#comb" onmouseout="UnTip()" onmouseover="Tip(sndclm_comb_tip)">comb</a> c3 x)))))))

; (<a class=quiet href="extsnd.html#mapchannel" onmouseout="UnTip()" onmouseover="Tip(extsnd_mapchannel_tip)">map-channel</a> (comb-chord .95 60 .3))

;;; or change the comb length via an envelope:

(define max-envelope
  (lambda (e mx)
    (if (null? e)
	mx
      (<a class=quiet href="sndscm.html#maxenvelope" onmouseout="UnTip()" onmouseover="Tip(sndscm_maxenvelope_tip)">max-envelope</a> (cddr e) (max mx (abs (cadr e)))))))

(define zcomb
  (lambda (scaler size pm)
    (let ((cmb (<a class=quiet href="sndclm.html#make-comb" onmouseout="UnTip()" onmouseover="Tip(sndclm_make_comb_tip)">make-comb</a> scaler size :max-size (+ size 1 (<a class=quiet href="sndscm.html#maxenvelope" onmouseout="UnTip()" onmouseover="Tip(sndscm_maxenvelope_tip)">max-envelope</a> pm 0))))
	  (penv (<a class=quiet href="sndclm.html#make-env" onmouseout="UnTip()" onmouseover="Tip(sndclm_make_env_tip)">make-env</a> pm :length (<a class=quiet href="extsnd.html#frames" onmouseout="UnTip()" onmouseover="Tip(extsnd_frames_tip)">frames</a>))))
      (lambda (x) (<a class=quiet href="sndclm.html#comb" onmouseout="UnTip()" onmouseover="Tip(sndclm_comb_tip)">comb</a> cmb x (<a class=quiet href="sndclm.html#env" onmouseout="UnTip()" onmouseover="Tip(sndclm_env_tip)">env</a> penv))))))

; (<a class=quiet href="extsnd.html#mapchannel" onmouseout="UnTip()" onmouseover="Tip(extsnd_mapchannel_tip)">map-channel</a> (zcomb .8 32 '(0 0 1 10)))

;;; to impose several formants, just add them in parallel:

(define formants
  (lambda (r1 f1 r2 f2 r3 f3)
    (let ((fr1 (<a class=quiet href="sndclm.html#make-formant" onmouseout="UnTip()" onmouseover="Tip(sndclm_make_formant_tip)">make-formant</a> f1 r1))
	  (fr2 (<a class=quiet href="sndclm.html#make-formant" onmouseout="UnTip()" onmouseover="Tip(sndclm_make_formant_tip)">make-formant</a> f2 r2))
	  (fr3 (<a class=quiet href="sndclm.html#make-formant" onmouseout="UnTip()" onmouseover="Tip(sndclm_make_formant_tip)">make-formant</a> f3 r3)))
      (lambda (x)
	(+ (<a class=quiet href="sndclm.html#formant" onmouseout="UnTip()" onmouseover="Tip(sndclm_formant_tip)">formant</a> fr1 x)
	   (<a class=quiet href="sndclm.html#formant" onmouseout="UnTip()" onmouseover="Tip(sndclm_formant_tip)">formant</a> fr2 x)
	   (<a class=quiet href="sndclm.html#formant" onmouseout="UnTip()" onmouseover="Tip(sndclm_formant_tip)">formant</a> fr3 x))))))

; (<a class=quiet href="extsnd.html#mapchannel" onmouseout="UnTip()" onmouseover="Tip(extsnd_mapchannel_tip)">map-channel</a> (formants .01 900 .02 1800 .01 2700))

;;; to get a moving formant:

(define moving-formant
  (lambda (radius move)
    (let ((frm (<a class=quiet href="sndclm.html#make-formant" onmouseout="UnTip()" onmouseover="Tip(sndclm_make_formant_tip)">make-formant</a> (cadr move) radius))
	  (menv (<a class=quiet href="sndclm.html#make-env" onmouseout="UnTip()" onmouseover="Tip(sndclm_make_env_tip)">make-env</a> move :length (<a class=quiet href="extsnd.html#frames" onmouseout="UnTip()" onmouseover="Tip(extsnd_frames_tip)">frames</a>))))
      (lambda (x)
        (let ((val (<a class=quiet href="sndclm.html#formant" onmouseout="UnTip()" onmouseover="Tip(sndclm_formant_tip)">formant</a> frm x)))
	  (set! (<a class=quiet href="sndclm.html#mus-frequency" onmouseout="UnTip()" onmouseover="Tip(sndclm_mus_frequency_tip)">mus-frequency</a> frm) (<a class=quiet href="sndclm.html#env" onmouseout="UnTip" onmouseover="Tip(sndclm_env_tip)">env</a> menv))
	  val)))))

; (<a class=quiet href="extsnd.html#mapchannel" onmouseout="UnTip()" onmouseover="Tip(extsnd_mapchannel_tip)">map-channel</a> (moving-formant .01 '(0 1200 1 2400)))

;;; various "Forbidden Planet" sound effects:

(define fp
  (lambda (sr osamp osfrq)
    (let* ((os (<a class=quiet href="sndclm.html#make-oscil" onmouseout="UnTip()" onmouseover="Tip(sndclm_make_oscil_tip)">make-oscil</a> osfrq))
	   (sr (<a class=quiet href="sndclm.html#make-src" onmouseout="UnTip()" onmouseover="Tip(sndclm_make_src_tip)">make-src</a> :srate sr))
	   (len (<a class=quiet href="extsnd.html#frames" onmouseout="UnTip()" onmouseover="Tip(extsnd_frames_tip)">frames</a>))
	   (sf (<a class=quiet href="extsnd.html#makesampler" onmouseout="UnTip()" onmouseover="Tip(extsnd_makesampler_tip)">make-sampler</a>))
	   (out-data (<a class=quiet href="extsnd.html#makevct" onmouseout="UnTip()" onmouseover="Tip(extsnd_makevct_tip)">make-vct</a> len)))
      (<a class=quiet href="extsnd.html#vctmap" onmouseout="UnTip()" onmouseover="Tip(extsnd_vctmap_tip)">vct-map!</a> out-data
		  (lambda () 
		    (<a class=quiet href="sndclm.html#src" onmouseout="UnTip()" onmouseover="Tip(sndclm_src_tip)">src</a> sr (* osamp (<a class=quiet href="sndclm.html#oscil" onmouseout="UnTip()" onmouseover="Tip(sndclm_oscil_tip)">oscil</a> os))
			 (lambda (dir)
			   (if (&gt; dir 0)
			       (<a class=quiet href="extsnd.html#nextsample" onmouseout="UnTip()" onmouseover="Tip(extsnd_nextsample_tip)">next-sample</a> sf)
			       (<a class=quiet href="extsnd.html#previoussample" onmouseout="UnTip()" onmouseover="Tip(extsnd_previoussample_tip)">previous-sample</a> sf))))))
      (<a class=quiet href="extsnd.html#freesampler" onmouseout="UnTip()" onmouseover="Tip(extsnd_freesampler_tip)">free-sampler</a> sf)
      (<a class=quiet href="extsnd.html#vcttochannel" onmouseout="UnTip()" onmouseover="Tip(extsnd_vcttochannel_tip)">vct-&gt;channel</a> out-data 0 len))))

; (fp 1.0 .3 20)


;;; -------- shift pitch keeping duration constant
;;;
;;; both src and granulate take a function argument to get input whenever it is needed.
;;; in this case, src calls granulate which reads the currently selected file.

(define <A class=def NAME="expsrc">expsrc</a>
  (lambda (rate)
    (let* ((gr (<a class=quiet href="sndclm.html#make-granulate" onmouseout="UnTip()" onmouseover="Tip(sndclm_make_granulate_tip)">make-granulate</a> :expansion rate))
	   (sr (<a class=quiet href="sndclm.html#make-src" onmouseout="UnTip()" onmouseover="Tip(sndclm_make_src_tip)">make-src</a> :srate rate))
	   (vsize 1024)
	   (vbeg 0)
	   (v (<a class=quiet href="extsnd.html#channeltovct" onmouseout="UnTip()" onmouseover="Tip(extsnd_channeltovct_tip)">channel-&gt;vct</a> 0 vsize))
	   (inctr 0))
      (lambda (inval)
        (<a class=quiet href="sndclm.html#src" onmouseout="UnTip()" onmouseover="Tip(sndclm_src_tip)">src</a> sr 0.0
	  (lambda (dir)
	    (<a class=quiet href="sndclm.html#granulate" onmouseout="UnTip()" onmouseover="Tip(sndclm_granulate_tip)">granulate</a> gr
	      (lambda (dir)
		(let ((val (v inctr)))
		  (set! inctr (+ inctr dir))
		  (if (&gt;= inctr vsize)
		      (begin
			(set! vbeg (+ vbeg inctr))
			(set! inctr 0)
			(<a class=quiet href="extsnd.html#channeltovct" onmouseout="UnTip()" onmouseover="Tip(extsnd_channeltovct_tip)">channel-&gt;vct</a> vbeg vsize 0 0 v)))
		  val)))))))))

</pre>
<p>Geez, I haven't had this much fun in a long time!  Check out <a href="sndscm.html#exampdoc">examp.scm</a> and <a href="sndscm.html#sndtestdoc">snd-test.scm</a> for more.  
You can load Rick Taube's CM into Snd as Scheme code:
</p>
<pre>
    snd -l /home/bil/test/cm-2.8.0/src/cm.scm
</pre>
<p>and all of CM is at your disposal! See also <a href="#sndwithcm">Snd and Common Music</a>.
</p>
<p>In most CLM instruments, including all those in clm-ins.scm, the assumption is that 
you're reading and writing a temp file, calling the instruments within with-sound.
The special generator snd-&gt;sample provides a way to redirect
the CLM input handlers (<a class=quiet href="sndclm.html#in-any" onmouseout="UnTip()" onmouseover="Tip(sndclm_in_any_tip)">in-any</a> in particular) to a Snd sound (via its index).
</p>
<br><br>



<table width="80%" border=0><tr><td bgcolor="lightsteelblue" valign="middle"><h3><A NAME="sndwithcm">Snd and Common Music</a></h3></td></tr></table>

<p>You can load Common Music into Snd.  The only real "gotcha" is that Snd's
ws.scm has to be loaded before cm's clm2.scm.  I load ws.scm in my init file,
but in the following example, I'll start -noinit, and load it explicitly.
</p>

<table border=0 cellpadding=5 hspace=20><tr><td><pre>
&gt; <em class=typing>(load "ws.scm")</em>
<em class=listener>#&lt;unspecified&gt;</em>
&gt; <em class=typing>(load "/home/bil/test/cm/src/cm.scm")</em>
<em class=listener>#&lt;unspecified&gt;</em>
&gt; <em class=typing>(definstrument (simp beg dur freq amp)
   (let* ((o (make-oscil freq))
          (st (seconds-&gt;samples beg))
          (nd (+ st (seconds-&gt;samples dur))))
     (run
       (do ((i st (+ 1 i)))
           ((= i nd))
         (outa i (* amp (oscil o)))))))</em>
<em class=listener>#&lt;values ()&gt;</em>
</pre></td></tr></table>

<p>
If the result of the definstrument call is <code>#&lt;unspecified&gt;</code> then cm's definstrument-hook isn't loaded into Snd's definstrument;
if you go on anyway, you'll get some complaint that there is no class named "simp".
</p>

<table border=0 cellpadding=5 hspace=20><tr><td><pre>
&gt; <em class=typing>(define (random-fn n) 
    (process repeat n output (new simp :beg (now) :dur .1 :freq (between 220 880) :amp .1) wait .25))</em>
<em class=listener>#&lt;unspecified&gt;</em>
&gt; <em class=typing>(events (random-fn 10) "test.clm" 0 :output "test.snd")</em>
<em class=listener>"test.clm"</em>
</pre></td></tr></table>

<p>and the result ("test.snd") is opened in Snd.
It's also possible to load sndlib into cm.  Here's a note from Rick:
</p>
<pre>
    a tarball of clm+cm in s7 scheme is available at 
    
        http://camil.music.uiuc.edu/Software/grace/downloads/cm3.tar.gz 
    
    the clm+cm app is fully relocatable and requires no runtime sources.   
    to use the app in emacs do 
    
    (setq scheme-program-name "/path/to/cm3/bin/cm") 
    M-x run-scheme 
    
    building is a snap: 
    
    wget ftp://ccrma-ftp.stanford.edu/pub/Lisp/sndlib.tar.gz 
    tar -zxf sndlib.tar.gz 
    cd sndlib 
    ./configure CC=g++ 
    make 
    cd .. 
    
    wget http://camil.music.uiuc.edu/Software/grace/downloads/cm3.tar.gz 
    tar -zxf cm3.tar.gz 
    cd cm3 
    premake --verbose --target gnu --juce /path/to/juce --sndlib ../sndlib 
    make 
    bin/cm 
    
    S7 Scheme 1.2, (c) 2008 William Schottstaedt 
    SNDLIB 20.10, (c) 2008 William Schottstaedt 
     /\\\ 
    ---\\\--------- 
    ----\\\-------- 
    ----/\\\------- Common Music 3.2.0 
    ---/--\\\------ 
    --/----\\\----- 
     /      \\\/ 
    Type 'q' to quit. 
    cm&gt; (list 1 2 3) 
    (1 2 3) 
    cm&gt; (load "/Users/hkt/Software/snd-12/v.scm") 
    fm-violin 
    cm&gt; (with-sound () (fm-violin 0 1 440 .1)) 
    "test.aiff" 
    cm&gt; (define (foo n ) 
      (process for i below n 
           do (display (list i (elapsed))) 
           (newline) 
           (wait .5))) 
    
    foo 
    cm&gt; (sprout (foo 10)) 
    (0 0.0) 
    (1 0.5000870000124) 
    (2 1.0009470000267) 
    (3 1.5018830000162) 
    (4 2.0025049999952) 
    (5 2.5038330000043) 
    (6 3.0042760000229) 
    (7 3.5051180000305) 
    (8 4.006182000041) 
    (9 4.5074370000362) 
    cm&gt; q 
    Killing scheme thread...quitting Scheme 
    Bye! 
</pre>



<br><br><br>
<table width="80%" border=0><tr><td bgcolor="lightsteelblue" valign="middle"><h3><A NAME="sndwithmotif">Snd and Motif</a></h3></td></tr></table>

<p>It is possible to add your own user-interface elements using the xm module
included with Snd.  'make xm' should create
a shared library named xm.so; you can load this at any time into Snd:
</p>
<pre>
    &gt; <em class=typing>(define hxm (dlopen "/home/bil/snd-12/xm.so"))</em>
    <em class=listener>#&lt;unspecified&gt;</em>
    &gt; <em class=typing>(dlinit hxm "Init_libxm")</em>
    <em class=listener>#t</em>
</pre>
<p>and now we have access to all of X and Motif.  Alternatively, use the
configure switch --with-static-xm, and the xm module will be included
in the base Snd image.
Here's a dialog window with a slider:</p>

<table border=0 cellpadding=5 hspace=20><tr><td><pre>
(define scale-dialog #f)
(define current-scaler 1.0)

(define (create-scale-dialog parent)
  (if (not (Widget? scale-dialog))
      (let ((xdismiss (XmStringCreate "Dismiss" XmFONTLIST_DEFAULT_TAG))
	    (xhelp (XmStringCreate "Help" XmFONTLIST_DEFAULT_TAG))
	    (titlestr (XmStringCreate "Scaling" XmFONTLIST_DEFAULT_TAG)))
	(set! scale-dialog 
	      (XmCreateTemplateDialog parent "Scaling"
                (list XmNcancelLabelString   xdismiss
		      XmNhelpLabelString     xhelp
		      XmNautoUnmanage        #f
		      XmNdialogTitle         titlestr
		      XmNresizePolicy        XmRESIZE_GROW
	              XmNnoResize            #f
		      XmNtransient           #f)))
	(XtAddCallback scale-dialog 
		       XmNcancelCallback (lambda (w context info)
					   (XtUnmanageChild scale-dialog)))
	(XtAddCallback scale-dialog 
		       XmNhelpCallback (lambda (w context info)
					 (<a class=quiet href="extsnd.html#sndprint" onmouseout="UnTip()" onmouseover="Tip(extsnd_sndprint_tip)">snd-print</a> "move the slider to affect the volume")))
	(XmStringFree xhelp)
	(XmStringFree xdismiss)
	(XmStringFree titlestr)

	(let* ((mainform 
		(XtCreateManagedWidget "formd" xmFormWidgetClass scale-dialog
                  (list XmNleftAttachment    XmATTACH_FORM
		        XmNrightAttachment   XmATTACH_FORM
		        XmNtopAttachment     XmATTACH_FORM
		        XmNbottomAttachment  XmATTACH_WIDGET
		        XmNbottomWidget      (XmMessageBoxGetChild scale-dialog XmDIALOG_SEPARATOR))))
	       (scale
		(XtCreateManagedWidget "" xmScaleWidgetClass mainform
		  (list XmNorientation XmHORIZONTAL
			XmNshowValue   #t
			XmNvalue       100
			XmNmaximum     500
			XmNdecimalPoints 2))))

      (XtAddCallback scale XmNvalueChangedCallback (lambda (w context info)
					     (set! current-scaler (/ (.value info) 100.0))))
      (XtAddCallback scale XmNdragCallback (lambda (w context info)
					     (set! current-scaler (/ (.value info) 100.0)))))))
  (XtManageChild scale-dialog))

(create-scale-dialog (cadr (<a class=quiet href="extsnd.html#mainwidgets" onmouseout="UnTip()" onmouseover="Tip(extsnd_mainwidgets_tip)">main-widgets</a>)))
</pre></td></tr></table>

<p>which creates a little dialog:
</p>

<img src="pix/scldlog.png" alt="scale dialog" hspace=20 vspace=20>
<p>
In Ruby, this is:</p>

<table border=0 cellpadding=5 hspace=20><tr><td><pre>
$scale_dialog = false
$current_scaler = 1.0

def create_scale_dialog(parent)
  if !RWidget?($scale_dialog) 
    then
      xdismiss = RXmStringCreate("Dismiss", RXmFONTLIST_DEFAULT_TAG)
      xhelp = RXmStringCreate("Help", RXmFONTLIST_DEFAULT_TAG)
      titlestr = RXmStringCreate("Scaling", RXmFONTLIST_DEFAULT_TAG)
      $scale_dialog = RXmCreateTemplateDialog(parent, "Scaling",
                   	[RXmNcancelLabelString,  xdismiss,
                      	 RXmNhelpLabelString,    xhelp,
                      	 RXmNautoUnmanage,       false,
                      	 RXmNdialogTitle,        titlestr,
                      	 RXmNresizePolicy,       RXmRESIZE_GROW,
                      	 RXmNnoResize,           false,
                       	 RXmNtransient,          false])
      RXtAddCallback($scale_dialog, RXmNcancelCallback, 
                     Proc.new { |w, context, info| RXtUnmanageChild($scale_dialog)})
      RXtAddCallback($scale_dialog, RXmNhelpCallback, 
                     Proc.new { |w, context, info| snd_print "move the slider to affect the volume"})
      RXmStringFree xhelp
      RXmStringFree xdismiss
      RXmStringFree titlestr
      mainform = RXtCreateManagedWidget("formd", RxmFormWidgetClass, $scale_dialog,
                  	[RXmNleftAttachment,      RXmATTACH_FORM,
                         RXmNrightAttachment,     RXmATTACH_FORM,
                         RXmNtopAttachment,       RXmATTACH_FORM,
                         RXmNbottomAttachment,    RXmATTACH_WIDGET,
                         RXmNbottomWidget,        RXmMessageBoxGetChild($scale_dialog, RXmDIALOG_SEPARATOR)])
      scale = RXtCreateManagedWidget("", RxmScaleWidgetClass, mainform,
                  	[RXmNorientation, RXmHORIZONTAL,
                         RXmNshowValue,   true,
                         RXmNvalue,       100,
                         RXmNmaximum,     500,
                         RXmNdecimalPoints, 2])
      RXtAddCallback(scale, RXmNvalueChangedCallback, 
                     Proc.new { |w, context, info| $current_scaler = Rvalue(info) / 100.0})
      RXtAddCallback(scale, RXmNdragCallback, 
                     Proc.new { |w, context, info| $current_scaler = Rvalue(info) / 100.0})
      RXtManageChild $scale_dialog
    end
end

$Snd_widgets = main_widgets()
create_scale_dialog $Snd_widgets[1]
</pre></td></tr></table>

<p>All of Snd is at your disposal once this module is loaded.
</p>
<br>

<table width="80%" border=0><tr><td bgcolor="lightsteelblue" valign="middle"><h3><A NAME="sndwithgtk">Snd and Gtk+</a></h3></td></tr></table>

<p>There are tons of examples of using the gtk module.  snd-gtk.scm is one
place to start.  All of gtk and cairo, and much of pango and glib are accessible from the
extension language if you loaded the xg module or built Snd with the configuration switch
--with-static-xg.
Here's the scale-dialog in xg/gtk:
</p>

<table border=0 cellpadding=5 hspace=20><tr><td><pre>
(define scale-dialog #f)
(define current-scaler 1.0)

(define (create-scale-dialog parent)
  (if (not scale-dialog)
      (begin
	(set! scale-dialog (gtk_dialog_new))
	(g_signal_connect scale-dialog "delete-event"
			     (lambda (w ev info)
			       (gtk_widget_hide w)))
	(gtk_window_set_title (GTK_WINDOW scale-dialog) "Scale")
	(gtk_widget_realize scale-dialog)
	(let ((dismiss (gtk_button_new_with_label "Dismiss"))
	      (help (gtk_button_new_with_label "Help")))
	  (gtk_box_pack_start (GTK_BOX (.action_area (GTK_DIALOG scale-dialog))) dismiss #t #t 4)
	  (gtk_box_pack_end (GTK_BOX (.action_area (GTK_DIALOG scale-dialog))) help #t #t 4)	
	  (g_signal_connect dismiss "clicked"
			       (lambda (w info)
				 (gtk_widget_hide scale-dialog)))
	  (g_signal_connect help "clicked"
			       (lambda (w info)
				 (<a class=quiet href="extsnd.html#helpdialog" onmouseout="UnTip()" onmouseover="Tip(extsnd_helpdialog_tip)">help-dialog</a> "Scaler Dialog" "move the slider to affect the volume")))
	  (gtk_widget_show dismiss)
	  (gtk_widget_show help)
	  (let* ((adj (gtk_adjustment_new 0.0 0.0 1.01 0.01 0.01 .01))
		 (scale (gtk_hscale_new (GTK_ADJUSTMENT adj))))
	    (gtk_range_set_update_policy (GTK_RANGE (GTK_SCALE scale)) GTK_UPDATE_CONTINUOUS)
	    (gtk_scale_set_draw_value (GTK_SCALE scale) #t)
	    (gtk_scale_set_digits (GTK_SCALE scale) 2)
	    (g_signal_connect adj "value_changed"
				 (lambda (wadj info)
				   (set! current-scaler (.value (GTK_ADJUSTMENT wadj)))))
	    (gtk_box_pack_start (GTK_BOX (.vbox (GTK_DIALOG scale-dialog))) scale #f #f 6)
	    (gtk_widget_show scale)))))
  (gtk_widget_show scale-dialog))

(create-scale-dialog (cadr (<a class=quiet href="extsnd.html#mainwidgets" onmouseout="UnTip()" onmouseover="Tip(extsnd_mainwidgets_tip)">main-widgets</a>)))
</pre></td></tr></table>

<p>The only change from the C code is the addition of GTK_ADJUSTMENT in the scale value_changed
callback &mdash; currently the xg module assumes the first argument to the two-argument callback is
a GtkWidget, so we have to cast a GtkAdjustment back to its original type.
</p>

<p>Here are a couple other examples of things that aren't covered by the gtk code in snd-gtk.scm and
friends:
</p>
<table border=0 cellpadding=5 hspace=20><tr><td><pre>
;; report on mouse scroll wheel changes when in the channel graph
(g_signal_connect 
 (car (<a class=quiet href="extsnd.html#channelwidgets" onmouseout="UnTip()" onmouseover="Tip(extsnd_channelwidgets_tip)">channel-widgets</a>)) "scroll_event" 
 (lambda (w e i)
   (<a class=quiet href="extsnd.html#sndprint" onmouseout="UnTip()" onmouseover="Tip(extsnd_sndprint_tip)">snd-print</a> (<a class=quiet onmouseout="UnTip()" onmouseover="Tip(scheme_format_tip)">format</a> #f "~%state: ~A, x: ~A, y: ~A, direction: ~A" 
		      (.state (GDK_EVENT_SCROLL e))
		      (.x (GDK_EVENT_SCROLL e))
		      (.y (GDK_EVENT_SCROLL e))
		      (.direction (GDK_EVENT_SCROLL e))))
   #f))

;; report which kind of click was received in the channel graph
(g_signal_connect 
 (car (<a class=quiet href="extsnd.html#channelwidgets" onmouseout="UnTip()" onmouseover="Tip(extsnd_channelwidgets_tip)">channel-widgets</a>)) "button_press_event"
 (lambda (w e i)
   (<a class=quiet href="extsnd.html#sndprint" onmouseout="UnTip()" onmouseover="Tip(extsnd_sndprint_tip)">snd-print</a> (<a class=quiet onmouseout="UnTip()" onmouseover="Tip(scheme_format_tip)">format</a> #f "~%button: ~A, ~A click" 
		      (.type (GDK_EVENT_BUTTON e))
		      (if (= (.type (GDK_EVENT_BUTTON e)) GDK_BUTTON_PRESS)
			  "single"
			  (if (= (.type (GDK_EVENT_BUTTON e)) GDK_2BUTTON_PRESS)
			      "double"
			      (if (= (.type (GDK_EVENT_BUTTON e)) GDK_3BUTTON_PRESS)
				  "triple"
				  "unknown")))))
   #f))

;; a double click is reported as single/single/double

;; double-click time in milliseconds(?)
(define (double-click-time)
  (g_object_get (GPOINTER 
                  (gtk_settings_get_for_screen 
                    (gdk_display_get_default_screen 
                      (gdk_display_get_default)))) 
                "gtk-double-click-time" #f))
</pre></td></tr></table>

<br>

<!-- INDEX sndwithnogui:Scripting -->
<table width="80%" border=0><tr><td bgcolor="lightsteelblue" valign="middle"><h3><A NAME="sndwithnogui">Snd with no GUI and as scripting engine</a></h3></td></tr></table>

<p>If Snd is built without a graphical user interface (by specifying
--with-no-gui to configure),
it runs the extension language's read-eval-print loop, with input from stdin.  All
the non-interface related functions are available, so you can do things
like:
</p>

<table border=0 cellspacing=10>
<tr><th bgcolor="#f2f4ff" align=left>Scheme</th><th></th><th bgcolor="beige" align=left>Ruby</th><th></th><th bgcolor="lightgreen" align=left>Forth</th></tr>

<tr>
<td bgcolor="#fbfbff"><pre>
snd
:<em class=typing>(new-sound "test.snd")</em>
<em class=listener>#&lt;sound 0&gt;</em>
:<em class=typing>(mix "oboe.snd")</em>
<em class=listener>(#&lt;mix 0&gt;)</em>
:<em class=typing>(frames)</em>
<em class=listener>50828</em>
:<em class=typing>(play)</em>
<em class=listener>#f</em>
:<em class=typing>(exit)</em>
</pre></td><td width=60></td>

<td bgcolor="#FdFdf2"><pre>
snd
&gt; <em class=typing>new_sound("test.snd")</em>
<em class=listener>0</em>
&gt; <em class=typing>mix("oboe.snd")</em>
<em class=listener>[#&lt;mix 0&gt;]</em>
&gt; <em class=typing>frames</em>
<em class=listener>50828</em>
&gt; <em class=typing>play</em>
<em class=listener>false</em>
&gt; <em class=typing>exit</em>
</pre></td><td width=60></td>

<td bgcolor="#EefdEe"><pre>
snd
<em class=typing>"test.snd" new-sound</em>
<em class=listener>0 ok</em>
<em class=typing>"oboe.snd" mix</em>
<em class=listener>-1 ok</em>
<em class=typing>frames</em>
<em class=listener>50828 ok</em>
<em class=typing>play</em>
<em class=listener>#f ok</em>
<em class=typing>snd-exit</em>
</pre></td>
</tr>
</table>


<p>
Since there's no graphics toolkit event loop to get in your way, you 
can treat this version of Snd as a scripting engine.  For example,
if you have an executable file with:
</p>

<table border=0 cellpadding=5 hspace=20><tr><td>
<pre>
#!/home/bil/test/snd-12/snd -l
!#
(define a-test 32)
(display "hiho")
(newline)
</pre></td></tr></table>

<p>it can be executed just like any such script.
</p>
<pre>
    /home/bil/test/snd-12/ script
    hiho
    :a-test
    32
    :(<a class=quiet href="extsnd.html#exit" onmouseout="UnTip()" onmouseover="Tip(extsnd_exit_tip)">exit</a>)
    /home/bil/test/snd-12/ 
</pre>
<p>
As noted above, you can use the -e switch to use Snd as a pure
command-line program, and, of course, (<a class=quiet href="extsnd.html#exit" onmouseout="UnTip()" onmouseover="Tip(extsnd_exit_tip)">exit</a>) to drop back to the shell.
Here's a script that doubles every sample in "oboe.snd" and
writes the result as "test.snd":
</p>


<table border=0 cellspacing=10>
<tr><th bgcolor="#f2f4ff" align=left>Scheme</th><th></th><th bgcolor="beige" align=left>Ruby</th><th></th><th bgcolor="lightgreen" align=left>Forth</th></tr>

<tr>
<td bgcolor="#fbfbff"><pre>
#!/home/bil/snd-12/snd -l
!#
(open-sound "oboe.snd")
(scale-by 2.0)
(save-sound-as "test.snd")
(exit)
</pre></td><td width=60></td>

<td bgcolor="#FdFdf2"><pre>
#!/home/bil/snd-12/snd -batch
open_sound "oboe.snd"
scale_by 2.0
save_sound_as "test.snd"
exit
</pre></td><td width=60></td>

<td bgcolor="#EefdEe"><pre>
#! /usr/bin/env /home/bil/forth-snd/snd
"oboe.snd" open-sound drop
2.0 #f #f scale-by drop
"test.snd" save-sound-as
snd-exit
</pre></td>
</tr>
</table>


<p>The functions <b>script-args</b> and <b>script-arg</b> can be used
to access the script's arguments, and if necessary (if not exiting)
tell Snd to ignore arguments.  script-args returns a list of strings
giving the arguments.  The first two are always "-l" and the script
file name. The current argument is (<a class=quiet href="extsnd.html#scriptarg" onmouseout="UnTip()" onmouseover="Tip(extsnd_scriptarg_tip)">script-arg</a>).  If you set this to
a higher value, Snd will subsequently ignore the intervening arguments
as it scans the startup arguments (see snd-test.scm).
</p>

<table border=0 cellpadding=5 hspace=20><tr><td><pre>
#!/home/bil/test/snd-12/snd -l
!#
(if (= (length (<a class=quiet href="extsnd.html#scriptargs" onmouseout="UnTip()" onmouseover="Tip(extsnd_scriptargs_tip)">script-args</a>)) 2) ;i.e. ("-l" "script")
  (display "usage: script file-name...")
  (begin
    (<a class=quiet href="extsnd.html#opensound" onmouseout="UnTip()" onmouseover="Tip(extsnd_opensound_tip)">open-sound</a> ((<a class=quiet href="extsnd.html#scriptargs" onmouseout="UnTip()" onmouseover="Tip(extsnd_scriptargs_tip)">script-args</a>) (+ (<a class=quiet href="extsnd.html#scriptarg" onmouseout="UnTip()" onmouseover="Tip(extsnd_scriptarg_tip)">script-arg</a>) 1)))
    (<a class=quiet href="extsnd.html#scaleby" onmouseout="UnTip()" onmouseover="Tip(extsnd_scaleby_tip)">scale-by</a> 2.0)
    (<a class=quiet href="extsnd.html#savesoundas" onmouseout="UnTip()" onmouseover="Tip(extsnd_savesoundas_tip)">save-sound-as</a> "test.snd")))
(<a class=quiet href="extsnd.html#exit" onmouseout="UnTip()" onmouseover="Tip(extsnd_exit_tip)">exit</a>)
</pre></td></tr></table>

<p>This either grumbles if no argument is given,
or scales its argument sound by 2.0:
</p>
<pre>
    script pistol.snd
</pre>
<p>And we can run through the entire argument list,
doubling all the sounds or whatever by using a do loop &mdash;
the following displays all the comments it finds:
</p>

<table border=0 cellpadding=5 hspace=20><tr><td><pre>
#!/home/bil/cl/snd -l
!#
(if (= (length (<a class=quiet href="extsnd.html#scriptargs" onmouseout="UnTip()" onmouseover="Tip(extsnd_scriptargs_tip)">script-args</a>)) 2) ;i.e. ("-l" "script")
  (display "usage: script file-name...")
  (do ((arg (+ (<a class=quiet href="extsnd.html#scriptarg" onmouseout="UnTip()" onmouseover="Tip(extsnd_scriptarg_tip)">script-arg</a>) 1) (+ 1 arg)))
      ((= arg (length (<a class=quiet href="extsnd.html#scriptargs" onmouseout="UnTip()" onmouseover="Tip(extsnd_scriptargs_tip)">script-args</a>))))
    (let ((name ((<a class=quiet href="extsnd.html#scriptargs" onmouseout="UnTip()" onmouseover="Tip(extsnd_scriptargs_tip)">script-args</a>) arg)))
      (display (<a class=quiet onmouseout="UnTip()" onmouseover="Tip(scheme_format_tip)">format</a> #f "~A: ~A~%" name (<a class=quiet href="extsnd.html#mussoundcomment" onmouseout="UnTip()" onmouseover="Tip(extsnd_mussoundcomment_tip)">mus-sound-comment</a> name))))))
(<a class=quiet href="extsnd.html#exit" onmouseout="UnTip()" onmouseover="Tip(extsnd_exit_tip)">exit</a>)
</pre></td></tr></table>

<p>
Say we save this as the file "comments".</p>
<pre>
    /home/bil/cl/comments *.snd
</pre>
<p>If you like, you can use env:</p>
<pre>
    #!/usr/bin/env snd
    !#
</pre>
<p>But if that works, so will:</p>
<pre>
    #!snd -l
    !#
</pre>
<p>
This scripting mechanism actually will work in any version of Snd;
to keep the Snd window from popping up, use the -b (-batch) switch in
place of -l.
Here's another script; it looks for any sounds that are longer
than 40 seconds in duration, and truncates them to 40 seconds:
</p>

<table border=0 cellpadding=5 hspace=20><tr><td><pre>
#!/usr/local/bin/snd -l
!#
(if (= (length (<a class=quiet href="extsnd.html#scriptargs" onmouseout="UnTip()" onmouseover="Tip(extsnd_scriptargs_tip)">script-args</a>)) 2)
  (display "usage: trunc.scm file-name...")
  (do ((arg (+ (<a class=quiet href="extsnd.html#scriptarg" onmouseout="UnTip()" onmouseover="Tip(extsnd_scriptarg_tip)">script-arg</a>) 1) (+ 1 arg)))
      ((= arg (length (<a class=quiet href="extsnd.html#scriptargs" onmouseout="UnTip()" onmouseover="Tip(extsnd_scriptargs_tip)">script-args</a>))))
    (let* ((name ((<a class=quiet href="extsnd.html#scriptargs" onmouseout="UnTip()" onmouseover="Tip(extsnd_scriptargs_tip)">script-args</a>) arg)))
      (if (&gt; (<a class=quiet href="extsnd.html#mussoundduration" onmouseout="UnTip()" onmouseover="Tip(extsnd_mussoundduration_tip)">mus-sound-duration</a> name) 40.0)
	  (let* ((ind (<a class=quiet href="extsnd.html#opensound" onmouseout="UnTip()" onmouseover="Tip(extsnd_opensound_tip)">open-sound</a> name)))
	    (set! (<a class=quiet href="extsnd.html#frames" onmouseout="UnTip()" onmouseover="Tip(extsnd_frames_tip)">frames</a> ind) (* 40 (<a class=quiet href="extsnd.html#srate" onmouseout="UnTip()" onmouseover="Tip(extsnd_srate_tip)">srate</a> ind)))
	    (<a class=quiet href="extsnd.html#savesound" onmouseout="UnTip()" onmouseover="Tip(extsnd_savesound_tip)">save-sound</a> ind)
	    (<a class=quiet href="extsnd.html#closesound" onmouseout="UnTip()" onmouseover="Tip(extsnd_closesound_tip)">close-sound</a> ind))))))
(<a class=quiet href="extsnd.html#exit" onmouseout="UnTip()" onmouseover="Tip(extsnd_exit_tip)">exit</a>)
</pre></td></tr></table>

<p>Here's a sndplay replacement script:</p>

<table border=0 cellpadding=5 hspace=20><tr><td><pre>
#!snd -b
!#
(play ((<a class=quiet href="extsnd.html#scriptargs" onmouseout="UnTip()" onmouseover="Tip(extsnd_scriptargs_tip)">script-args</a>) (+ (<a class=quiet href="extsnd.html#scriptarg" onmouseout="UnTip()" onmouseover="Tip(extsnd_scriptarg_tip)">script-arg</a>) 1)) :wait #t)
(<a class=quiet href="extsnd.html#exit" onmouseout="UnTip()" onmouseover="Tip(extsnd_exit_tip)">exit</a>)
</pre></td></tr></table>

<p>And here's a script that splits a multichannel file
into a bunch of mono files:
</p>

<table border=0 cellpadding=5 hspace=20><tr><td><pre>
#!snd -b
!#
(if (= (length (<a class=quiet href="extsnd.html#scriptargs" onmouseout="UnTip()" onmouseover="Tip(extsnd_scriptargs_tip)">script-args</a>)) 2)
  (display "usage: split.scm filename")
  (let* ((name ((<a class=quiet href="extsnd.html#scriptargs" onmouseout="UnTip()" onmouseover="Tip(extsnd_scriptargs_tip)">script-args</a>) (+ 1 (<a class=quiet href="extsnd.html#scriptarg" onmouseout="UnTip()" onmouseover="Tip(extsnd_scriptarg_tip)">script-arg</a>))))
	 (chns (channels name)))
    (if (&gt; chns 1)
	(let ((ind (<a class=quiet href="extsnd.html#opensound" onmouseout="UnTip()" onmouseover="Tip(extsnd_opensound_tip)">open-sound</a> name)))
	  (do ((i 0 (+ 1 i)))
	      ((= i chns))
	    (display (<a class=quiet onmouseout="UnTip()" onmouseover="Tip(scheme_format_tip)">format</a> #f "~A.~D " name i))
	    (<a class=quiet href="extsnd.html#savesoundas" onmouseout="UnTip()" onmouseover="Tip(extsnd_savesoundas_tip)">save-sound-as</a> (<a class=quiet onmouseout="UnTip()" onmouseover="Tip(scheme_format_tip)">format</a> #f "~A.~D" name i)
			   ind
			   (<a class=quiet href="extsnd.html#headertype" onmouseout="UnTip()" onmouseover="Tip(extsnd_headertype_tip)">header-type</a> ind)
			   (<a class=quiet href="extsnd.html#dataformat" onmouseout="UnTip()" onmouseover="Tip(extsnd_dataformat_tip)">data-format</a> ind)
			   (<a class=quiet href="extsnd.html#srate" onmouseout="UnTip()" onmouseover="Tip(extsnd_srate_tip)">srate</a> ind)
			   i))
	  (<a class=quiet href="extsnd.html#closesound" onmouseout="UnTip()" onmouseover="Tip(extsnd_closesound_tip)">close-sound</a> ind)))))
(<a class=quiet href="extsnd.html#exit" onmouseout="UnTip()" onmouseover="Tip(extsnd_exit_tip)">exit</a>)
</pre></td></tr></table>

<br>
<br>

<table width="80%" border=0><tr><td bgcolor="lightsteelblue" valign="middle"><h3><A NAME="sndandruby">Snd with Ruby</a></h3></td></tr></table>

<p>Ruby is an extension language described as an "object-oriented Perl".
It provides a different syntax from that of Scheme; most of the *.scm (Scheme)
files have corresponding *.rb (Ruby) files (written by Mike Scholz), so there's
no penalty for using Ruby rather than Scheme.  The only drawback is that
the documentation uses Scheme.  The differences between Scheme and Ruby, however, are not
too severe.
In Ruby, the following changes are made in the function names (as presented in Scheme):
"-" becomes "_", "-&gt;" becomes "2", hooks and current_sound have "$" prepended
(since they are global variables from Ruby's point of view), and all the constants are capitalized
(e.g. Autocorrelation).  The generalized set! functions are replaced
by "set_" plus the base name (e.g. set_window_width), with arguments
reordered in some cases to place the optional values after the new value.  That is,
<code>(set! (<a class=quiet href="extsnd.html#sync" onmouseout="UnTip()" onmouseover="Tip(extsnd_sync_tip)">sync</a> snd) 1)</code> becomes <code>set_sync(1, snd)</code>.
Hooks in Ruby (which have little or nothing to do with Ruby's "hookable variables")
are just procedures or nil, not lists of procedures as in Scheme.
Here's a Ruby version of the init file given
above (named ~/.snd_ruby):
</p>

<table border=0 cellpadding=5 hspace=20><tr><td><pre>
set_window_width 800
set_window_height 500

set_listener_font "9x15"
set_axis_numbers_font "9x15"

set_show_mix_waveforms true
set_trap_segfault false
set_show_indices true

set_listener_prompt ":"
show_listener

beige = make_color 0.96, 0.96, 0.86
blue = make_color 0, 0, 1
set_selected_graph_color beige
set_selected_data_color blue
</pre></td></tr></table>

<p>Procedures are created via Proc.new, so to set the open-hook to print the
file name,
</p>
<pre>
    &gt;<em class=typing>$open_hook = Proc.new { |name| snd_print name }</em>
    <em class=listener>#&lt;Proc:0x40221b84&gt;</em>
    &gt;<em class=typing>open_sound "oboe.snd"</em>
    <em class=listener>/home/bil/cl/oboe.snd
    0</em>
</pre>
<p>(The trailing "0" is the result of open_sound).
The Scheme hook list support procedures aren't included in Ruby &mdash;
simply set the variable to the procedure you want, or false to clear it.
</p>
<p>Vcts and sound-data objects mixin "Comparable" and "Enumerable", and respond to various array-like methods:
</p>
<pre>
    &gt;<em class=typing>v1 = make_vct 4</em>
    <em class=listener>#&lt;vct[len=4]: 0.000 0.000 0.000 0.000&gt;</em>
    &gt;<em class=typing>v1[3] = 1.0</em>
    <em class=listener>1.0</em>
    &gt;<em class=typing>v1.sort</em>
    <em class=listener>0.00.00.01.0</em> # I don't know why it prints this way but ...
    &gt;<em class=typing>v1</em>
    <em class=listener>#&lt;vct[len=4]: 0.000 0.000 0.000 1.000&gt;</em>
    &gt;<em class=typing>v1.max</em>
    <em class=listener>1.0</em>
</pre>
<p>
Keywords, CLM generic functions, and optional arguments work as in Scheme:
</p>
<pre>
    &gt;<em class=typing>osc = make_oscil(:frequency, 440)</em>
    <em class=listener>oscil freq: 440.000Hz, phase: 0.000</em>
    &gt;<em class=typing>oscil osc</em>
    <em class=listener>0.0</em>
    &gt;<em class=typing>oscil osc</em>
    <em class=listener>0.1250506192</em>
    &gt;<em class=typing>osc.frequency</em>
    <em class=listener>440.0</em>
</pre>
<p>Lists (from the Scheme point of view) are arrays (vectors) in Ruby.
Here's one more example, a translation of display-energy in draw.scm:
</p>

<table border=0 cellpadding=5 hspace=20><tr><td><pre>
def display_energy(snd, chn)
  ls = left_sample
  rs = right_sample
  data1 = make_graph_data(snd, chn)
  data = data1
  if not vct? data
    data = data1[1]
  end
  len = vct_length data
  sr = srate snd
  y_max = y_zoom_slider(snd, chn)
  vct_multiply!(data, data)
  graph(data, "energy", ls / sr, rs / sr, 0.0, y_max * y_max, snd, chn, false)
  end

# $lisp_graph_hook = Proc.new {|snd, chn| display_energy(snd, chn)}
</pre></td></tr></table>

<p>
In Ruby you make a symbol by prepending ":", so Scheme's
</p>
<pre>
    (list 'KeySym (char-&gt;integer #\F))
</pre> 
<p>becomes</p>
<pre>
    [:KeySym, ?F]
</pre>

<p>In the listener, everything is line-oriented (that is, I'm not trying to
catch incomplete expressions).  And it appears that in Ruby, variables defined
within a file are considered local to that file(?).
For Ruby as an Emacs subjob, see inf-snd.el.
</p>
<br>

<table width="80%" border=0><tr><td bgcolor="lightsteelblue" valign="middle"><h3><A NAME="sndandforth">Snd with Forth</a></h3></td></tr></table>

<p>Snd can be built with Forth as its extension language.  Forth is available at:
</p>
<pre>
    http://sourceforge.net/projects/fth
</pre>
<p>An example initialization file (~/.snd_forth) is given in the <a href="#sndinitfile">initialization</a> section.
Mike Scholz (creator of the Forth library we use) has provided a bunch of Forth files along the lines of the
Scheme and Ruby files described above &mdash; see *.fs.  See also Mike's very fine documentation in the fth package.
Here's an example from his fth.texi file showing how to define an instrument and use it in with-sound:
</p>

<table border=0 cellpadding=5 hspace=20><tr><td><pre>
instrument: src-simp { start dur amp sr sr-env fname -- }
    :file fname make-readin { f }
    :input f input-fn :srate sr make-src { sr }
    :envelope sr-env :duration dur make-env { en }
    start dur run
        i                 \ sample position for outa
        sr en env #f src
        amp f*
        *output* outa drop
    loop
    f mus-close drop
;instrument
"/usr/gnu/sound/SFiles/fyow.snd" value fyow-snd
#( 0.0 0.0 50.0 1.0 100.0 0.0 ) value sr-env
0.0 1.5 0.5 0.2 sr-env array-&gt;list fyow-snd ' src-simp with-sound
</pre></td></tr></table>

<br><br>


<table width="80%" border=0><tr><td bgcolor="lightsteelblue" valign="middle"><h3><A NAME="sndands7">Snd with s7</a></h3></td></tr></table>

<p>s7 is a Scheme implementation included in the Snd tarball and described in <a href="s7.html">s7.html</a>.  It is now the Snd default extension language.
</p>

<p>
The s7 initialization file is ~/.snd_s7.
</p>
<br><br>


<!-- INDEX sndandladspa:Plugins -->
<table width="80%" border=0><tr><td bgcolor="lightsteelblue" valign="middle"><h3><A NAME="sndandladspa">Snd and LADSPA Plugins</a></h3></td></tr></table>

<pre>
  <a class=def name="initladspa">init-ladspa</a>
  <a class=def name="listladspa">list-ladspa</a>
  <a class=def name="analyseladspa">analyse-ladspa</a> library plugin [also <b>analyze-ladspa</b>]
  <a class=def name="ladspadescriptor">ladspa-descriptor</a> library plugin
  <a class=def name="applyladspa">apply-ladspa</a> reader data duration origin snd chn

  <em class=emdef>ladspa-instantiate</em> descriptor srate
  <em class=emdef>ladspa-activate</em> descriptor handle
  <em class=emdef>ladspa-deactivate</em> descriptor handle
  <em class=emdef>ladspa-cleanup</em> descriptor handle
  <em class=emdef>ladspa-connect-port</em> descriptor handle port vct
  <em class=emdef>ladspa-run</em> descriptor handle count
  <em class=emdef>ladspa-run-adding</em> descriptor handle count
  <em class=emdef>ladspa-set-run-adding-gain</em> descriptor handle gain
</pre>

<p>Richard Furse has provided a module to support LADSPA plugins in Snd.
Here is his documentation:</p>
<pre>
Supporting functions are:

	(init-ladspa)

	Performs a search of LADSPA_PATH for plugins, doesn't need to be called 
as LADSPA automatically initialises on first use however can be used to 
reinitialise if new plugins have arrived.

	(list-ladspa)

	Returns a list of lists where each inner list contains a string to 
identify the plugin library and a string to identify the plugin type within 
the library.

	(analyse-ladspa plugin-library plugin-type)

	Returns a list of assorted data about a particular plugin including a 
list of port descriptions. plugin-library and plugin-type are as provided 
by list-ladspa.

The main function is:

	(apply-ladspa reader (plugin-library plugin-type [param1 [param2 ...]]) samples origin snd chn)

	Applies a LADSPA plugin to a block of samples. 
An example call to apply the low-pass-filter in the CMT plugin library is 
(apply-ladspa (<a class=quiet href="extsnd.html#makesampler" onmouseout="UnTip()" onmouseover="Tip(extsnd_makesampler_tip)">make-sampler</a> 0) (list "cmt" "lpf" 1000) 10000 "origin").
</pre>
<p>Dave Phillips in <a href="http://www.oreillynet.com/pub/a/linux/2001/02/02/ladspa.html">Linux Audio Plug-Ins: A Look Into LADSPA</a> adds this:
</p>
<pre>
  (apply-ladspa (<a class=quiet href="extsnd.html#makesampler" onmouseout="UnTip()" onmouseover="Tip(extsnd_makesampler_tip)">make-sampler</a> 57264) (list "cmt" "delay_5s" .3 .5) 32556 "ibm.wav")
</pre>
<p>
"This sequence tells Snd to read a block of 32556 samples from the ibm.wav file, starting at sample number 57264,
 and apply the delay_5s LADSPA plug-in (Richard Furse's delay plug-in, also found in cmt.so) with a delay time of
.3 seconds and a 50/50 dry/wet balance."
</p>
<p>To help Snd find the plugin library, set either the Snd variable <a href="extsnd.html#ladspadir">ladspa-dir</a> or the environment variable LADSPA_PATH
to the directory.
If, for example,
cmt.so is in /usr/local/lib/ladspa, (and you're using tcsh), then
</p>
<pre>
  setenv LADSPA_PATH /usr/local/lib/ladspa
</pre>
<p>or</p>
<pre>
  (set! (ladspa-dir) "/usr/local/lib/ladspa")
</pre>
<p>Snd plugins may have any number of inputs and outputs; if more
than one input is required, the first argument to apply-ladspa should be a list of readers:
</p>
<pre>
  (apply-ladspa (list (<a class=quiet href="extsnd.html#makesampler" onmouseout="UnTip()" onmouseover="Tip(extsnd_makesampler_tip)">make-sampler</a> 0 0 0)  ;chan 0
                      (<a class=quiet href="extsnd.html#makesampler" onmouseout="UnTip()" onmouseover="Tip(extsnd_makesampler_tip)">make-sampler</a> 0 0 1)) ;chan 1
                (list "cmt" "freeverb3" 0 .5 .5 .5 .5 .5) 
                100000 "freeverb")
</pre>
<p><a name="ladspachannel"></a>The "regularized" version of apply-ladspa could be defined:
</p>
<table border=0 cellpadding=5 hspace=20><tr><td><pre>
(define* (ladspa-channel ladspa-data (beg 0) ndur snd chn (edpos -1))
  (let* ((dur (or ndur (- (<a class=quiet href="extsnd.html#frames" onmouseout="UnTip()" onmouseover="Tip(extsnd_frames_tip)">frames</a> snd chn) beg)))
	 (reader (<a class=quiet href="extsnd.html#makesampler" onmouseout="UnTip()" onmouseover="Tip(extsnd_makesampler_tip)">make-sampler</a> beg snd chn 1 edpos)))
    (let ((result (<em class=red>apply-ladspa</em> reader ladspa-data dur "apply-ladspa" snd chn)))
      (<a class=quiet href="extsnd.html#freesampler" onmouseout="UnTip()" onmouseover="Tip(extsnd_freesampler_tip)">free-sampler</a> reader)
      result)))
</pre></td></tr></table>

<p>There are also functions to access the LADSPA descriptor directly:
</p>
<pre>
    (define ptr (ladspa-descriptor "amp" "amp_mono"))
    (.Label ptr)
        "amp_mono"
    (.Name ptr)
        "Mono Amplifier"
    (.Copyright ptr)
        "None"
    (.Maker ptr)
        "Richard Furse (LADSPA example plugins)"
    (.Properties ptr)
        4
    (.UniqueID ptr)
        1048
    (.PortNames ptr)
        ("Gain" "Input" "Output")
    (.PortRangeHints ptr)
        ((593 0.0 0.0) (0 0.0 0.0) (0 0.0 0.0))
    (.PortCount ptr)
        3
    (.PortDescriptors ptr)
        (5 9 10)
    (logand (cadr (.PortDescriptors ptr)) LADSPA_PORT_INPUT)
        1
</pre>
<p>See ladspa.h for full details. We could replace analyse-ladspa using these functions:
</p>
<table border=0 cellpadding=5 hspace=20><tr><td><pre>
(define (analyze-ladspa library label)
  (let* ((descriptor (<em class=red>ladspa-descriptor</em> library label))
	 (data '())
	 (names (.PortNames descriptor))
	 (hints (.PortRangeHints descriptor))
	 (descriptors (.PortDescriptors descriptor))
	 (name (.Name descriptor))
	 (maker (.Maker descriptor))
	 (copy (.Copyright descriptor)))
    (for-each
     (lambda (port ranges port-name)
       (if (and (not (= (logand port LADSPA_PORT_CONTROL) 0))
		(not (= (logand port LADSPA_PORT_INPUT) 0)))
	   (let ((ldata '())
		 (hint (car ranges))
		 (lo (cadr ranges))
		 (hi (caddr ranges)))
	     (if (not (= (logand hint LADSPA_HINT_TOGGLED) 0)) (set! ldata (cons "toggle" ldata)))
	     (if (not (= (logand hint LADSPA_HINT_LOGARITHMIC) 0)) (set! ldata (cons "logarithmic" ldata)))
	     (if (not (= (logand hint LADSPA_HINT_INTEGER) 0)) (set! ldata (cons "integer" ldata)))
	     (if (not (= (logand hint LADSPA_HINT_SAMPLE_RATE) 0)) (set! ldata (cons "sample_rate" ldata)))
	     (if (not (= (logand hint LADSPA_HINT_BOUNDED_ABOVE) 0)) 
		 (begin
		   (set! ldata (cons hi ldata))
		   (set! ldata (cons "maximum" ldata))))
	     (if (not (= (logand hint LADSPA_HINT_BOUNDED_BELOW) 0) )
		 (begin
		   (set! ldata (cons lo ldata))
		   (set! ldata (cons "minimum" ldata))))
	     (set! ldata (cons port-name ldata))
	     (set! data (cons ldata data)))))
     descriptors hints names)
    (append (list name maker copy) data)))
</pre></td></tr></table>
<p>Here's a function that processes a channel of data through a plugin, sending the 
data directly to the DAC:
</p>
<table border=0 cellpadding=5 hspace=20><tr><td><pre>
(define* (ladspa-it library label :rest plugin-parameters)
  ;; (ladspa-it "cmt" "delay_5s" .3 .5)
  (init-ladspa)
  (let* ((descriptor (ladspa-descriptor library label))
	 (handle (ladspa-instantiate descriptor (<a class=quiet href="extsnd.html#srate" onmouseout="UnTip()" onmouseover="Tip(extsnd_srate_tip)">srate</a>)))
	 (block-size 256)
	 (in-block (<a class=quiet href="extsnd.html#makevct" onmouseout="UnTip()" onmouseover="Tip(extsnd_makevct_tip)">make-vct</a> block-size))
	 (out-block (<a class=quiet href="extsnd.html#makevct" onmouseout="UnTip()" onmouseover="Tip(extsnd_makevct_tip)">make-vct</a> block-size))
	 (len (<a class=quiet href="extsnd.html#frames" onmouseout="UnTip()" onmouseover="Tip(extsnd_frames_tip)">frames</a>))
	 (data (<a class=quiet href="extsnd.html#makesounddata" onmouseout="UnTip()" onmouseover="Tip(extsnd_makesounddata_tip)">make-sound-data</a> 1 block-size))
	 (audio-port (<a class=quiet href="extsnd.html#musaudioopenoutput" onmouseout="UnTip()" onmouseover="Tip(extsnd_musaudioopenoutput_tip)">mus-audio-open-output</a> mus-audio-default (<a class=quiet href="extsnd.html#srate" onmouseout="UnTip()" onmouseover="Tip(extsnd_srate_tip)">srate</a>) 1 <a class=quiet href="extsnd.html#dataformat" onmouseout="UnTip()" onmouseover="Tip(extsnd_muslshort_tip)">mus-lshort</a> (* block-size 2))))
  (dynamic-wind
   (lambda ()
     (let ((count 0))
       (for-each 
	(lambda (port)
	  (if (not (= (logand port LADSPA_PORT_CONTROL) 0))
	      (let ((parameter (<a class=quiet href="extsnd.html#makevct" onmouseout="UnTip()" onmouseover="Tip(extsnd_makevct_tip)">make-vct</a> 1 (car plugin-parameters))))
		(set! plugin-parameters (cdr plugin-parameters))
		(ladspa-connect-port descriptor handle count parameter))
	      (if (not (= (logand port LADSPA_PORT_INPUT) 0))
		  (ladspa-connect-port descriptor handle count in-block)
		  (ladspa-connect-port descriptor handle count out-block)))
	  (set! count (+ 1 count)))
	(.PortDescriptors descriptor))))
   (lambda ()
     (ladspa-activate descriptor handle)
     (do ((i 0 (+ i block-size)))
	 ((&gt;= i len))
       (<a class=quiet href="extsnd.html#vctsubseq" onmouseout="UnTip()" onmouseover="Tip(extsnd_vctsubseq_tip)">vct-subseq</a> (<a class=quiet href="extsnd.html#channeltovct" onmouseout="UnTip()" onmouseover="Tip(extsnd_channeltovct_tip)">channel-&gt;vct</a> i block-size) 0 block-size in-block)
       (ladspa-run descriptor handle block-size)
       (<a class=quiet href="extsnd.html#vcttosounddata" onmouseout="UnTip()" onmouseover="Tip(extsnd_vcttosounddata_tip)">vct-&gt;sound-data</a> out-block data 0)
       (<a class=quiet href="extsnd.html#musaudiowrite" onmouseout="UnTip()" onmouseover="Tip(extsnd_musaudiowrite_tip)">mus-audio-write</a> audio-port data block-size)))
   (lambda ()
     (ladspa-deactivate descriptor handle)
     (<a class=quiet href="extsnd.html#musaudioclose" onmouseout="UnTip()" onmouseover="Tip(extsnd_musaudioclose_tip)">mus-audio-close</a> audio-port)
     (ladspa-cleanup descriptor handle)))))
</pre></td></tr></table>
<p>
One slight "gotcha"
in this area: the Snd configuration switch --with-doubles causes "vcts" to
be arrays of doubles, but Ladspa plugins expect to see arrays of floats.
This is a problem only if you're calling ladpsa-connect-port yourself.
</p>
<br>

<!-- INDEX sndandalsa:Alsa -->
<table width="80%" border=0><tr><td bgcolor="lightsteelblue" valign="middle"><h3><A NAME="sndandalsa">Snd and ALSA</a></h3></td></tr></table>

<p>
(This section is a lightly edited copy of some notes Fernando sent me).
The default ALSA device in Snd is "default".  This virtual device tries to play sounds at any sampling rate,
provide any number of input channels, handle data format conversions, and so on.  Experts will probably
want to use the "hw:0" device instead (this is the first hardware device; "hw:1" is the second, and so on),
but in that case, ALSA provides only whatever sampling rates the hardware provides. 
To change the device, or the internal buffering amounts, you can either set up environment
variables, or use the parallel Scheme/Ruby/Forth variables mus-alsa-*. The environment
variables are:
</p>
<table hspace=20>
<tr><td width=250>MUS_ALSA_PLAYBACK_DEVICE</td><td>name of playback device ("default")</td></tr>
<tr><td>MUS_ALSA_CAPTURE_DEVICE</td><td>name of capture (recording) device ("default")</td></tr>
<tr><td>MUS_ALSA_DEVICE</td><td>name of the playback and capture device ("sndlib")</td></tr>
<tr><td>MUS_ALSA_BUFFERS</td><td>number of "periods" (buffers) used</td></tr>
<tr><td>MUS_ALSA_BUFFER_SIZE</td><td>number of samples per channel per buffer</td></tr>
</table>
<p>
These can be set either in your shell initialization file (~/.cshrc for tcsh), or in the
shell:
</p>
<pre>
    setenv MUS_ALSA_DEVICE "hw:0"   ; tcsh
    MUS_ALSA_DEVICE="hw:0"          ; bash
</pre>
<p>
or run Snd with a temporary setting:
</p>
<pre>
    MUS_ALSA_DEVICE="plughw:0" snd somefile.wav
</pre>
<p>
The parallel variables (for ~/.snd and friends, or at any time in the listener), are:
</p>
<table hspace=20>
<tr><td width=250>mus-alsa-playback-device</td><td>name of playback device ("default")</td></tr>
<tr><td>mus-alsa-capture-device</td><td>name of capture (recording) device ("default")</td></tr>
<tr><td>mus-alsa-device</td><td>name of the playback and capture device ("sndlib")</td></tr>
<tr><td>mus-alsa-buffers</td><td>number of "periods" (buffers) used</td></tr>
<tr><td>mus-alsa-buffer-size</td><td>number of samples per channel per buffer</td></tr>
</table>
<p>
So, to use the "plughw" device, we could:
</p>
<pre>
    (set! (mus-alsa-device) "plughw:0")
</pre>
<p>
Similarly, if you know which device you want to record from (say your arecord command is
"arecord -D hw:0.2"), you can tell Snd's recorder to use that device via:
</p>
<pre>
    setenv MUS_ALSA_CAPTURE_DEVICE "hw:0.2"
</pre>
<p>
or
</p>
<pre>
    (set! (mus-alsa-capture-device) "hw:0.2")
</pre>
<p>It's also possible to define your own device, apparently, but that part
of ALSA is beyond my ken.
</p>

<br>

<!-- INDEX sndandjack:Jack --> 
<table width="80%" border=0><tr><td bgcolor="lightsteelblue" valign="middle"><h3><A NAME="sndandjack">Snd and Jack</a></h3></td></tr></table> 

<p>(This section is from Kjetil Matheussen).
</p>

<table hspace=20> 
<tr><td width=300>
SNDLIB_JACK_DONT_AUTOCONNECT</td><td>If set, snd won't autoconnect jack ports
</td></tr> 
<tr><td>
SNDLIB_NUM_JACK_CHANNELS</td><td>Number of in and out jack ports created by snd
</td></tr> 
</table> 

<br><br>


<table width="80%" border=0><tr><td bgcolor="lightsteelblue" valign="middle"><h3><A NAME="sndandgl">Snd and OpenGL</a></h3></td></tr></table>

<p>Snd with Motif can be used in conjunction with OpenGL.  If it is configured
with the switch --with-gl or --with-just-gl, the top level Snd shell
is setup to handle OpenGL graphics.  These are used automatically by
the spectrogram display; the colormap and viewing angle are set by either the View:Color/Orientation
dialog or <a href="extsnd.html#colormap">colormap</a>, and the
various spectro-*
variables.
</p>
<img src="pix/nowgl.png" alt="gl" hspace=20>
<p>
The GL-to-Scheme bindings are in gl.c, and follow the same name and type
conventions of the Motif bindings in xm.c.
Any of the Snd drawing area widgets (or your own) can receive GL graphics
commands.  Here is a translation of the SGI/xjournal glxmotif
program:
</p>
<table border=0 cellpadding=5 hspace=20><tr><td><pre>
(define (draw-it)
  (glXMakeCurrent (XtDisplay (cadr (<a class=quiet href="extsnd.html#mainwidgets" onmouseout="UnTip()" onmouseover="Tip(extsnd_mainwidgets_tip)">main-widgets</a>))) 
		  (XtWindow (car (<a class=quiet href="extsnd.html#channelwidgets" onmouseout="UnTip()" onmouseover="Tip(extsnd_channelwidgets_tip)">channel-widgets</a>)))
		  (snd-glx-context)) ; the GL context
  (glEnable GL_DEPTH_TEST)
  (glDepthFunc GL_LEQUAL)
  (glClearDepth 1.0)
  (glClearColor 0.0 0.0 0.0 0.0)
  (glLoadIdentity)
  (gluPerspective 40.0 1.0 10.0 200.0)
  (glTranslatef 0.0 0.0 -50.0)
  (glRotatef -58.0 0.0 1.0 0.0)
  (let ((vals (XtVaGetValues (car (<a class=quiet href="extsnd.html#channelwidgets" onmouseout="UnTip()" onmouseover="Tip(extsnd_channelwidgets_tip)">channel-widgets</a>)) (list XmNwidth 0 XmNheight 0))))
    (glViewport 0 0 (vals 1) (vals 3)))
  (glClear (logior GL_COLOR_BUFFER_BIT GL_DEPTH_BUFFER_BIT))
  (glBegin GL_POLYGON)
  (glColor3f 0.0 0.0 0.0)   (glVertex3f -10.0 -10.0 0.0)
  (glColor3f 0.7 0.7 0.7)   (glVertex3f 10.0 -10.0 0.0)
  (glColor3f 1.0 1.0 1.0)   (glVertex3f -10.0 10.0 0.0)
  (glEnd)
  (glBegin GL_POLYGON)
  (glColor3f 1.0 1.0 0.0)   (glVertex3f 0.0 -10.0 -10.0)
  (glColor3f 0.0 1.0 0.7)   (glVertex3f 0.0 -10.0 10.0)
  (glColor3f 0.0 0.0 1.0)   (glVertex3f 0.0 5.0 -10.0)
  (glEnd)
  (glBegin GL_POLYGON)
  (glColor3f 1.0 1.0 0.0)   (glVertex3f -10.0 6.0 4.0)
  (glColor3f 1.0 0.0 1.0)   (glVertex3f -10.0 3.0 4.0)
  (glColor3f 0.0 0.0 1.0)   (glVertex3f 4.0 -9.0 -10.0)
  (glColor3f 1.0 0.0 1.0)   (glVertex3f 4.0 -6.0 -10.0)
  (glEnd)
  (glXSwapBuffers (XtDisplay (cadr (<a class=quiet href="extsnd.html#mainwidgets" onmouseout="UnTip()" onmouseover="Tip(extsnd_mainwidgets_tip)">main-widgets</a>))) 
		  (XtWindow (car (<a class=quiet href="extsnd.html#channelwidgets" onmouseout="UnTip()" onmouseover="Tip(extsnd_channelwidgets_tip)">channel-widgets</a>))))
  (glFlush))
</pre></td></tr></table>

<p>See snd-gl.scm.  To turn these graphs into Postscript files, include the --with-gl2ps switch
at configuration time, and use the <a href="extsnd.html#glgraphtops">gl-graph-&gt;ps</a> function.
</p>
<br><br>


<!-- ---------------------------------------- GSL ---------------------------------------- -->

<table width="80%" border=0><tr><td bgcolor="lightsteelblue" valign="middle"><h3><A NAME="sndandgsl">Snd and GSL</a></h3></td></tr></table>

<p>If the GSL library is available, the following functions are imported into Snd:
</p>

<table border=0 cellspacing=4 cellpadding=6 hspace=20>

<!-- gsl-dht -->
<tr><td colspan=2 bgcolor="#f2f4ff">
<em class=emdef>gsl-dht</em> <code>size data nu xmax</code>
</td></tr><tr><td width=60></td><td>
gsl-dht performs the Hankel transform of "data", a vct.  See <a href="extsnd.html#addtransform">add-transform</a>
for an example.
</td></tr><tr><td colspan=2 height=16></td></tr>


<!-- gsl-eigenvectors -->
<tr><td colspan=2 bgcolor="#f2f4ff">
<em class=emdef>gsl-eigenvectors</em> <code>matrix</code>
</td></tr><tr><td width=60></td><td>
gsl-eigenvectors returns the eigenvalues and corresponding eigenvectors of "matrix", a mixer.

<pre>
&gt;<em class=typing>(gsl-eigenvectors (make-mixer 4  -1.0 1.0 -1.0 1.0
                               -8.0 4.0 -2.0 1.0
                               27.0 9.0 3.0 1.0
                               64.0 16.0 4.0 1.0))</em>
<em class=listener>(#(-6.41391102627093 5.54555349890946 5.54555349890946 2.32280402845201) 
#(#(-0.0998821746683654 -0.111251309674367 0.292500673281302 0.94450518972065) 
  #(-0.0434869537653505 0.0642376994169207 -0.515252756143484 -0.840592191366022) 
  #(-0.0434869537653505 0.0642376994169207 -0.515252756143484 -0.840592191366022) 
  #(-0.144932944248023 0.356601443087312 0.91936884368837 0.0811836295983152)))</em>
</pre>

The value returned is a list of two elements.  The first is a vector containing
the eigenvalues, the second is a vector containing the corresponding eigenvectors (as vectors).
See make-dpss-window in snd-test.scm (the corresponding C code is in clm.c).
</td></tr><tr><td colspan=2 height=16></td></tr>


<!-- gsl-elliptk -->
<tr><td colspan=2 bgcolor="#f2f4ff">
<em class=emdef>gsl-ellipk</em> <code>k</code><br>
<em class=emdef>gsl-ellipj</em> <code>j u m</code>
</td></tr><tr><td width=60></td><td>
These are calls on the functions gsl_sf_ellint_Kcomp and gsl_sf_elljac_e.  See the elliptic filter code in
analog-filter.scm for an example.
</td></tr><tr><td colspan=2 height=16></td></tr>

<!-- gsl-roots -->
<tr><td colspan=2 bgcolor="#f2f4ff">
<em class=emdef>gsl-roots</em> <code>poly</code>
</td></tr><tr><td width=60></td><td>
This returns the roots of the polynomial "poly" via gsl_poly_complex_solve.  See analog-filter.scm for an example.
</td></tr><tr><td colspan=2 height=16></td></tr>

</table>

<br><br>


<!-- ---------------------------------------- GMP, MPFR, MPC ---------------------------------------- -->

<table width="80%" border=0><tr><td bgcolor="lightsteelblue" valign="middle"><h3><A NAME="sndandgmp">Snd and multiprecision arithmetic</a></h3></td></tr></table>

<p>Multiprecision arithmetic for integer, ratio, real, and complex numbers is available
in Snd via the gmp, mpfr, and mpc libraries and s7.  Use the --with-gmp configuration
switch.  This version of s7 also supplies the functions:
</p>

<table border=0 cellspacing=4 cellpadding=6 hspace=20>

<!-- bignum -->
<tr><td colspan=2 bgcolor="#f2f4ff">
<em class=emdef>bignum</em> <code>num</code>
</td></tr><tr><td width=60></td><td>
<p>bignum converts its argument (a string) into a big number.  This is the most convenient
way to force a calculation to use big numbers.
</p>
<pre>
    <em class=listener>:</em><em class=typing>(sqrt 2)</em>
    <em class=listener>1.4142135623731</em>
    <em class=listener>:</em><em class=typing>(sqrt (bignum "2"))</em>
    <em class=listener>1.414213562373095048801688724209698078569E0</em>
</pre>
<p>
s7 uses normal C arithmetic unless something causes it to be suspicious.
Since a number like 1.2345e-14 does not trigger an underflow in C,
and is short (it's written with less than 20 characters), s7 trusts it even in a case
such as:
</p>
<pre>
    :(+ 1.2345e-15 1.0 -1.0)
    1.3322676295502e-15
</pre>
<p>In any case like this where C doubles are going to lose, you can force
big float arithmetic by making one of the operands a bignum:
</p>
<pre>
    :(+ (bignum "1.2345e-15") 1.0 -1.0)
    1.234500000000000042481989819014552503046E-15
</pre>
<p>There are lots of similar cases:
</p>
<pre>
    :(* 2e-170 3e-170 4e+170 5e+170)
    0.0
    :(* (bignum "2e-170") 3e-170 4e+170 5e+170)
    1.200000000000000019643628722298292475697E2
</pre>
<p>but presumably you know when you're using these kinds
of numbers.
</p>
</td></tr><tr><td colspan=2 height=16></td></tr>

<!-- bignum? -->
<tr><td colspan=2 bgcolor="#f2f4ff">
<em class=emdef>bignum?</em> <code>num</code>
</td></tr><tr><td width=60></td><td>
<p>bignum? returns #t if its argument is a big number.
</p>
</td></tr><tr><td colspan=2 height=16></td></tr>

<!-- bignum-fft -->
<tr><td colspan=2 bgcolor="#f2f4ff">
<em class=emdef>bignum-fft</em> <code>rl im size <em class=narg>sign</em></code>
</td></tr><tr><td width=60></td><td>
bignum-fft performs an FFT using big floats; rl and im are vectors of big floats.
</td></tr><tr><td colspan=2 height=16></td></tr>


<!-- bignum-precision -->
<tr><td colspan=2 bgcolor="#f2f4ff">
<em class=emdef>bignum-precision</em> <code></code>
</td></tr><tr><td width=60></td><td>
<p>bignum-precision sets the number of bits used in floating-point big numbers (integer 
bignums have whatever size it takes to represent them).  The default is 128 which gives
about 40 decimal digits.
</p>
<pre>
   <em class=listener>:</em><em class=typing>(* 2 pi)</em>
   <em class=listener>6.283185307179586476925286766559005768391E0</em>
   <em class=listener>:</em><em class=typing>(set! (bignum-precision) 256)</em>
   <em class=listener>256</em>
   <em class=listener>:</em><em class=typing>(* 2 pi)</em>
   <em class=listener>6.283185307179586476925286766559005768394338798750211641949889184615632812572396E0</em>
</pre>
<p>If a big float is so large that the current bignum-precision has to approximate it,
you can get confusing results:
</p>
<pre>
    :(rationalize 385817946978768113605842402465609185854927496022065152.5)
    385817946978768113605842402465609185854927496022065152
    :(set! (bignum-precision) 512)
    512
    :(rationalize 385817946978768113605842402465609185854927496022065152.5)
    771635893957536227211684804931218371709854992044130305/2
</pre>
<p>Yet another source of confusion involves the conversion of the string representation
of a bigfloat:
</p>
<pre>
    :(bignum "0.1")
    1.000000000000000055511151231257827021182E-1
    :(/ (bignum "1.0") 10)
    1.000000000000000000000000000000000000001E-1
</pre>
</td></tr><tr><td colspan=2 height=16></td></tr>

</table>

<p>I think I'll eventually add bignum versions of all the CLM generators.  Here, for example,
is a bigfloat oscil:
</p>

<table border=0 hspace=40><tr><td>
<pre>
(defgenerator (big-oscil 
  :make-wrapper 
    (lambda (g)
      (set! (big-oscil-frequency g) (/ (* (big-oscil-frequency g) 2.0 pi) (mus-srate)))
      g))
  (frequency *clm-default-frequency*) (angle 0.0))

(define* (big-oscil gen (fm 0.0) (pm 0.0))
  (let ((x (big-oscil-angle gen)))
    (set! (big-oscil-angle gen) (+ fm x (big-oscil-frequency gen)))
    (sin (+ x pm))))
</pre>
</td></tr></table>

<p>Ideally, the run macro would know how to handle bignums (and complex numbers).
But, one thing at a time...
</p>

<br><br>

<table border=0 bordercolor="lightgreen" width=100% cellpadding=1 cellspacing=0><tr><td bgcolor="lightgreen">
<table width="100%" border=0><tr><td bgcolor="beige" align="center" valign="middle"><h2><A NAME="otherstuff">Other stuff</a></h2></td></tr></table>
</td></tr></table>
<br>

<p>lint.scm is a lint program for s7 scheme.
</p>

<p>pretty-print.scm is a pretty-printer written by Marc Feeley, and changed slightly for s7.
</p>

<p>primes.scm is a list of primes for the <a href="sndscm.html#peakphasesdoc">peak phases</a> functions.
</p>

<p>The tools directory has several things that might be of interest.  sam.c is a
Samson box emulator.  crossref.c is a cross-referencer for the Snd sources.
exs7.c is one of the examples from s7.html.  xgdata.scm and makexg.scm create xg.c,
the Gtk bindings.  Similarly gldata.scm and makegl.scm create gl.c, the OpenGL bindings.  make-index.scm
creates index.html, the overall Snd index, and performs a lot of HTML error checks.
snd.supp is the suppressions list for valgrind.  table.scm creates the table of contents
at the start of snd-test.scm.  The other files in the tools directory are intended
for semi-automatic regression testing.
</p>

<br><br>


<center>
<table bgcolor="aliceblue" border=0 cellspacing=8><tr>
<td><small>related documentation:</small></td>
<td><small><a href="snd.html" onmouseout="UnTip()" onmouseover="Tip(snd_html_tip)">snd.html</a></small></td>
<td><small><a href="extsnd.html" onmouseout="UnTip()" onmouseover="Tip(extsnd_html_tip)">extsnd.html</a></small></td>
<td><small><a href="sndscm.html" onmouseout="UnTip()" onmouseover="Tip(sndscm_html_tip)">sndscm.html</a></small></td>
<td><small><a href="sndclm.html" onmouseout="UnTip()" onmouseover="Tip(sndclm_html_tip)">sndclm.html</a></small></td>
<td><small><a href="fm.html" onmouseout="UnTip()" onmouseover="Tip(fm_html_tip)">fm.html</a></small></td>
<td><small><a href="sndlib.html" onmouseout="UnTip()" onmouseover="Tip(sndlib_html_tip)">sndlib.html</a></small></td>
<td><small><a href="libxm.html" onmouseout="UnTip()" onmouseover="Tip(libxm_html_tip)">libxm.html</a></small></td>
<td><small><a href="s7.html" onmouseout="UnTip()" onmouseover="Tip(s7_html_tip)">s7.html</a></small></td>
<td><small><a href="index.html" onmouseout="UnTip()" onmouseover="Tip(index_html_tip)">index.html</a></small></td>
</tr></table>
</center>

</body></html>
